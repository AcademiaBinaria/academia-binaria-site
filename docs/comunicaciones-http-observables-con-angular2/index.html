<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!--Description-->
    
        <meta name="description" content="Artículos y tutoriales sobre Angular, NodeJs, MongoDB y todo lo relacionado con JavaScript y TypeScript">
    

    <!--Author-->
    
        <meta name="author" content="Alberto Basalo">
    

    <!--Open Graph Title-->
    
        <meta property="og:title" content="Comunicaciones http observables con Angular2"/>
    

    <!--Open Graph Description-->
    
        <meta property="og:description" content="Artículos y tutoriales sobre Angular, NodeJs, MongoDB y todo lo relacionado con JavaScript y TypeScript" />
    

    <!--Open Graph Site Name-->
    <meta property="og:site_name" content="Academia Binaria"/>

    <!--Type page-->
    
        <meta property="og:type" content="article" />
    

    <!--Page Cover-->
    

    <meta name="twitter:card" content="summary" />
    

    <!-- Title -->
    
    <title>Comunicaciones http observables con Angular2 - Academia Binaria</title>

    <!-- Tachyons Core CSS -->
    <link rel="stylesheet" href="//unpkg.com/tachyons/css/tachyons.min.css">

    <!-- Custom Fonts -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="//oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="//oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/academia-binaria-site/css/style.css">

    <!-- Google Analytics -->
    


</head>


<body>

<!-- Main Content -->
<!-- Banner -->
<!-- Banner -->
<div class="w-100 bg-1 ph5-ns ph3 text-light">
    
    <nav class="db dt-l w-100 mw8 center border-box pv3">
        <a class="db dtc-l v-mid link dim w-100 w-25-l tc tl-l mb2 mb0-l white" href="/academia-binaria-site/" title="Academia Binaria">
            <img src="/images/logo-academia-binaria-white.png" class="dib h3" alt="Academia Binaria">
        </a>
        <div class="db dtc-l v-mid w-100 w-75-l tc tr-l">
            
                <a class="link dim f6 f5-l dib mr3 mr4-l white" 
                    href="/academia-binaria-site/" 
                    title="Inicio">
                    Inicio
                </a>
            
                <a class="link dim f6 f5-l dib mr3 mr4-l white" 
                    href="/academia-binaria-site/archives" 
                    title="Archivos">
                    Archivos
                </a>
            
                <a class="link dim f6 f5-l dib mr3 mr4-l white" 
                    href="/academia-binaria-site/cursos.html" 
                    title="Cursos">
                    Cursos
                </a>
            
                <a class="link dim f6 f5-l dib mr3 mr4-l white" 
                    href="/academia-binaria-site/contacto.html" 
                    title="Contacto">
                    Contacto
                </a>
            
        </div>
    </nav>

    <!-- Title -->
    <div class="w-100 mw8 center vh-40 dt">
        <div class="dtc v-mid white">
            <h1 class="f1-l f2-m tc tc-m tl-ns">Comunicaciones http observables con Angular2</h1>
            <p class="f4 fw3 pab-100px tc tc-m tl-ns">16-06-2016</p>
        </div>
    </div>

    <!-- Icon -->
    <div class="relative w-100 mw8 center white dn dn-m db-ns">
        <i class="header-icon fa fa-file-text-o"></i>
    </div>
</div>

<!-- Content -->
<div class="w-100 ph2 ph4-m ph5-l mv5 mv6-l">
    <div class="content">
        <div class="mw8 center">
            <div class="cf">
                <div class="fl w-100 w-70-l mw7 left fw3 lh-copy pr4-ns pr0-m post-content">
                    <!-- Main Post Content -->
                    <p>En AngularJS, y en otros frameworks del lado cliente, la idea de fue simple desde el principio: dame <strong>plantillas estáticas y datos dinámicos</strong>. Las comunicaciones <em>http</em> son las arterias vitales de transporte de esos datos dinámicos. Y en Angular 2 se han revisado por completo, llevando las comunicaciones asíncronas al siguiente nivel.</p>
<h3 id="La-libreria-http-y-otras…"><a href="#La-libreria-http-y-otras…" class="headerlink" title="La librería http y otras…"></a>La librería http y otras…</h3><p>Como cabe esperar Angular 2 dispone de su propio módulo de comunicaciones. En la librería <code>@angular/http</code> encontramos el nuevo servicio <code>http</code> que es el cliente usado para enviar y recibir datos.</p>
<p>Lo realmente novedoso viene de parte del proyecto <a href="http://reactivex.io/rxjs/" target="_blank" rel="external">Reactive Extensions o RxJS</a>. En su librería <code>rxjs/Observable</code> exporta la clase <code>Observable</code>. Esta clase implementa el <strong>patrón observador aplicado a streams</strong> de datos. El equipo de Angular ha decidido adoptarlo para procesar los <em>streams</em> de entrada y salida de datos <em>http</em>.</p>
<p>Un servicio típico que necesite comunicaciones con el servidor importará al menos estos objetos.</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Importar objetos de la librería http</span></div><div class="line"><span class="keyword">import</span> &#123; Http, Response, RequestOptions, Headers &#125; <span class="keyword">from</span> <span class="string">'@angular/http'</span>;</div><div class="line"><span class="comment">// Importar la clase Observable desde la librería rxjs</span></div><div class="line"><span class="keyword">import</span> &#123; Observable &#125;     <span class="keyword">from</span> <span class="string">'rxjs/Observable'</span>;</div></pre></td></tr></table></figure>
<p>Los servicios importados han de ser <strong>registrados como <em>providers</em> para poder ser inyectados como dependencias</strong> antes de ser consumidos. Ya que se trata de servicios de amplio uso en cualquier aplicación, se recomienda registrarlos en módulos de alto nivel. De esa forma pueden ser reutilizados como <em>singletons</em>.</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// importar la constante con los proveedores de http</span></div><div class="line"><span class="keyword">import</span> &#123; HttpModule, Http &#125; <span class="keyword">from</span> <span class="string">'@angular/http'</span>;</div><div class="line"></div><div class="line"><span class="meta">@NgModule</span>(&#123;</div><div class="line">  declarations: [ ],</div><div class="line">  imports: [</div><div class="line">    HttpModule, <span class="comment">// El módulo con todo lo necesario</span></div><div class="line">  ],</div><div class="line">  providers:[</div><div class="line">    Http, <span class="comment">// El servicio proveedor</span></div><div class="line">  ]</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>A partir de ese momento cualquier componente o servicio puede reclamar su inyección en el constructor, y lo podrá usar en sus propios métodos.<br><figure class="highlight typescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment">* Constructor que reclama dependencias inyectables</span></div><div class="line"><span class="comment">* Http se encuentra por haberse registrado en este módulo o en uno superior</span></div><div class="line"><span class="comment">**/</span></div><div class="line"><span class="keyword">constructor</span>(<span class="params"><span class="keyword">private</span> http: Http</span>) &#123;</div><div class="line">   <span class="comment">// en el constructor no debe contener lógica extra</span></div><div class="line">   <span class="comment">// su función es únicamente recibir las dependencias</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="Observables-en-lugar-de-promesas"><a href="#Observables-en-lugar-de-promesas" class="headerlink" title="Observables en lugar de promesas"></a>Observables en lugar de promesas</h3><p>La naturaleza asíncrona de las comunicaciones entre maquinas se implementó mediante <em>callbacks</em> en JavaScript. Esta forma de programar degenera en código difícil de mantener. Con el tiempo el <strong>patrón promesa</strong> se impuso, y en AngularJS 1.x es la manera recomendada de programar.</p>
<p>Pero las promesas también tiene sus limitaciones, y ahí aparecen los <strong>observables</strong>. Este patrón requerirá un artículo para el sólo, pero como adelanto se resume en lo siguiente:</p>
<blockquote>
<p>Tratar todo tipo de información como un stream observable de entrada y de salida, al cual se le pueden agregar operaciones que procesan los flujos de datos.</p>
</blockquote>
<p>Esto encaja muy bien con las comunicaciones <em>http</em> asíncronas y es la razón de su adopción en Angular 2. Un método de servicio par <strong>leer datos REST</strong> se parecerá a este <em>snippet</em>:</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// las llamadas devuelven observables</span></div><div class="line">leerDatos(): Observable&lt;Response&gt; &#123;</div><div class="line">  <span class="comment">// Se declara cómo va a ser la llamada </span></div><div class="line">  <span class="comment">// ocultando los pormenores a los consumidores   </span></div><div class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.http</div><div class="line">    .get(<span class="string">`<span class="subst">$&#123;this.urlBase&#125;</span>/recurso`</span>);</div><div class="line">  <span class="comment">// En este momento aún no se efectuó la llamada</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Para enviar información via <em>post</em> o <em>put</em> usaremos una estrategia similar, pero con unos requisitos específicos. En Angular 2 se requiere una configuración previa de las llamadas de escritura. Es engorroso pero fácilmente automatizable. Una típica operación de <strong>escritura REST</strong> sería algo así:</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">escribirDatos(unDato): Observable&lt;Response&gt; &#123;</div><div class="line">  <span class="comment">// Los envíos de información deben configurarse a mano</span></div><div class="line">  <span class="comment">// esto es fácilmente generalizable y reutilizable</span></div><div class="line">  <span class="keyword">let</span> body = <span class="built_in">JSON</span>.stringify(unDato);</div><div class="line">  <span class="keyword">let</span> headers = <span class="keyword">new</span> Headers(&#123; <span class="string">'Content-Type'</span>: <span class="string">'application/json'</span> &#125;);</div><div class="line">  <span class="keyword">let</span> options = <span class="keyword">new</span> RequestOptions(&#123; headers: headers &#125;);</div><div class="line">  <span class="comment">// declarar la llamada y retornar el observable</span></div><div class="line">  <span class="comment">// las variables de configuración y los datos, van como parámetros</span></div><div class="line">  <span class="keyword">if</span> (unDato._id) &#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.http</div><div class="line">      .put(<span class="string">`<span class="subst">$&#123;this.urlBase&#125;</span>/recurso/<span class="subst">$&#123;unDato._id&#125;</span>`</span>, body, options);</div><div class="line">  &#125; <span class="keyword">else</span> &#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.http</div><div class="line">      .post(<span class="string">`<span class="subst">$&#123;this.urlBase&#125;</span>/recurso`</span>, body, options);</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Por supuesto esto es lo que se programa a bajo nivel, en los <strong>servicios de comunicaciones</strong>. En Angular2 se mantiene la recomendación de bajar a servicios la responsabilidad de las comunicaciones al tiempo que dejamos los componentes lo más ligeros posible. </p>
<p>Por encima de los servicios de comunicaciones habrá otros servicios de lógica o directamente componentes. En cualquier caso, los consumidores llamarán a métodos que siempre les devolverán objetos observables. Las clases de alto nivel se <strong>suscribirán a esos observables</strong> y procesarán la respuesta recibida… cuando esta esté disponible.</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// La carga de datos se hace al iniciarse el componente</span></div><div class="line"><span class="comment">// este es el lugar donde programar lógica de inicio</span></div><div class="line"><span class="comment">// nunca en el constructor</span></div><div class="line">ngOnInit() &#123;</div><div class="line">  <span class="comment">// en el momento de la suscripción es cuando se dispara la llamada</span></div><div class="line">  <span class="keyword">this</span>.datosService</div><div class="line">    .leerDatos()</div><div class="line">    .subscribe(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</div><div class="line">      <span class="keyword">this</span>.datos = res.json();</div><div class="line">    &#125;);</div><div class="line">  <span class="comment">// Sería similar en procesos de escritura</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>La clase <code>http</code> no realiza la llamada hasta que algún consumidor se suscriba a la respuesta. Mientras tanto queda como una definición congelada.</p>
</blockquote>
<p>El método <code>.subscribe()</code> recibe como argumento un puntero a la respuesta <em>http</em>. Los datos se encuentran en formato <em>JSON</em> y hay que reclamarlos mediante el método <code>.json()</code></p>
<h3 id="Extensiones-en-lugar-de-interceptores"><a href="#Extensiones-en-lugar-de-interceptores" class="headerlink" title="Extensiones en lugar de interceptores"></a>Extensiones en lugar de interceptores</h3><p>Una de las características destacables de los servicios <code>$http</code> de AngularJS 1.x era la posibilidad de usar <em>interceptores</em>. Estos eran <strong>funciones que se incrustaban durante el envío o recepción</strong> de las comunicaciones.</p>
<p>Un uso habitual era emplearlos para agregar <strong>cabeceras de seguridad o controlar errores</strong> de comunicación de manera centralizada. Ahora la forma recomendable de hacer eso mismo en Angular2 es mejorar el servicio http extendiéndolo. El servicio derivado resultante implementará los interceptores en funciones llamadas durante la comunicación.</p>
<p>Esta es una posible implementación con funcionalidad suficiente para facilitar los envíos, detectar errores y enviar cabeceras de seguridad.<br><figure class="highlight typescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Injectable</span>()</div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Extensión personalizada de la clase HTTP</span></div><div class="line"><span class="comment"> * Permite la configuración de todas las peticiones</span></div><div class="line"><span class="comment"> * Captura los envíos y respuestas</span></div><div class="line"><span class="comment"> * */</span></div><div class="line"><span class="keyword">export</span> <span class="keyword">class</span> HttpService <span class="keyword">extends</span> Http &#123;</div><div class="line">  <span class="comment">/** Las direcciones base deberían venir de la configuración del environment*/</span></div><div class="line">  <span class="keyword">public</span> apiProxyUrl = <span class="string">'http://localhost:4030/api/'</span>;</div><div class="line">  <span class="keyword">private</span> authorization = <span class="string">''</span>;</div><div class="line"></div><div class="line">  <span class="keyword">constructor</span>(<span class="params"></span></div><div class="line"><span class="params">    backend: XHRBackend,</span></div><div class="line"><span class="params">    defaultOptions: RequestOptions,</span></div><div class="line"><span class="params">    <span class="keyword">private</span> router: Router,</span></div><div class="line"><span class="params">    <span class="keyword">private</span> userStore: SessionStoreService</span></div><div class="line"><span class="params">  </span>) &#123;</div><div class="line">    <span class="keyword">super</span>(backend, defaultOptions);</div><div class="line">    <span class="keyword">this</span>.subscribeToToken();</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="comment">/**</span></div><div class="line"><span class="comment">   * Reescribe el método de la clase base, ejecutando acciones para cada petición</span></div><div class="line"><span class="comment">   * La peticiíón en curso puede llegar como una ruta o una clase request</span></div><div class="line"><span class="comment">   * Si viene sólo la cadena, debería traer las opciones aparte</span></div><div class="line"><span class="comment">   * */</span></div><div class="line">  request(request: <span class="built_in">string</span> | Request, options: RequestOptionsArgs = &#123; headers: <span class="keyword">new</span> Headers() &#125;): Observable&lt;Response&gt; &#123;</div><div class="line">    <span class="keyword">this</span>.configureRequest(request, options);</div><div class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.interceptResponse(request, options);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="keyword">private</span> subscribeToToken() &#123;</div><div class="line">    <span class="comment">// suponemos un servicio que nos avisa de la recepción de tokens</span></div><div class="line">    <span class="keyword">this</span>.userStore</div><div class="line">      .getDataObservable()</div><div class="line">      .subscribe(<span class="function">(<span class="params">data: Session</span>) =&gt;</span> <span class="keyword">this</span>.authorization = <span class="string">'Bearer '</span> + data.token);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="keyword">private</span> configureRequest(request: <span class="built_in">string</span> | Request, options: RequestOptionsArgs) &#123;</div><div class="line">    <span class="comment">// Adapta la ruta y asigna cabeceras</span></div><div class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> request === <span class="string">'string'</span>) &#123;</div><div class="line">      request = <span class="keyword">this</span>.getProxyUrl(request);</div><div class="line">      <span class="keyword">this</span>.setHeaders(options);</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">      request[<span class="string">'url'</span>] = <span class="keyword">this</span>.getProxyUrl(request[<span class="string">'url'</span>]);</div><div class="line">      <span class="keyword">this</span>.setHeaders(request);</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="keyword">private</span> interceptResponse(request: <span class="built_in">string</span> | Request, options: RequestOptionsArgs) : Observable&lt;Response&gt; &#123;</div><div class="line">    <span class="keyword">const</span> observableRequest = <span class="keyword">super</span></div><div class="line">      .request(request, options)</div><div class="line">      .catch(<span class="keyword">this</span>.onCatch())</div><div class="line">      .finally(<span class="keyword">this</span>.onFinally());</div><div class="line">    <span class="keyword">return</span> observableRequest;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="comment">/**</span></div><div class="line"><span class="comment">   * Transforma la url para llamar a trave´s de un proxy </span></div><div class="line"><span class="comment">   * Útil en caso de problemas con el CORS</span></div><div class="line"><span class="comment">   */</span></div><div class="line">  <span class="keyword">private</span> getProxyUrl(currentUrl) &#123;</div><div class="line">    <span class="keyword">if</span> (!currentUrl.includes(<span class="string">'/assets/'</span>)) &#123;</div><div class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.apiProxyUrl + currentUrl;</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">      <span class="keyword">return</span> currentUrl;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="comment">/**</span></div><div class="line"><span class="comment">   * Interceptor para componer las cabeceras en cada petición</span></div><div class="line"><span class="comment">   * */</span></div><div class="line">  <span class="keyword">private</span> setHeaders(objectToSetHeadersTo: Request | RequestOptionsArgs) &#123;</div><div class="line">    <span class="keyword">const</span> headers = objectToSetHeadersTo.headers;</div><div class="line">    headers.set(<span class="string">'Content-Type'</span>, <span class="string">'application/json'</span>);</div><div class="line">    headers.set(<span class="string">'Authorization'</span>, <span class="keyword">this</span>.authorization);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="comment">/**</span></div><div class="line"><span class="comment">   * Interceptor para captura genérica de errores http</span></div><div class="line"><span class="comment">   * */</span></div><div class="line">  <span class="keyword">private</span> onCatch() &#123;</div><div class="line">    <span class="keyword">return</span> <span class="function">(<span class="params">res: Response</span>) =&gt;</span> &#123;</div><div class="line">      <span class="comment">// Security errors</span></div><div class="line">      <span class="keyword">if</span> (res.status === <span class="number">401</span> || res.status === <span class="number">403</span>) &#123;</div><div class="line">        <span class="comment">// redirigir al usuario para pedir credenciales</span></div><div class="line">        <span class="keyword">this</span>.router.navigate([<span class="string">'user/login'</span>]);</div><div class="line">      &#125;</div><div class="line">      <span class="comment">// To Do: Gestión común de otros errores...</span></div><div class="line">      <span class="keyword">return</span> Observable.throw(res);</div><div class="line">    &#125;;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="keyword">private</span> onFinally() &#123;</div><div class="line">    <span class="keyword">return</span> <span class="function"><span class="params">()</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">'Fin'</span>);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>Podemos usarlo de manera transparente en el resto de la aplicación. Sólo se necesita ajustar el registro de proveedores para dirigir al inyector de dependencias hacia esta nueva clase.<br><figure class="highlight typescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"> providers: [</div><div class="line">  &#123;</div><div class="line">    provide: Http, <span class="comment">// reemplaza el servicio del framework</span></div><div class="line">    useClass: HttpService <span class="comment">// con la clase personalizada que lo extiende</span></div><div class="line">  &#125;</div><div class="line">]</div></pre></td></tr></table></figure></p>
<blockquote>
<p>Este es uno de los usos más potentes de la inversión de control en Angular. Es el programador integrador el que decide el servicio a usar. El programador funcional declara la dependencia en los constructores de sus componentes y servicios, pero no decide la instancia concreta que recibirá.</p>
</blockquote>
<p>Angular 2 ha trastocado todo lo que hacíamos en las versiones 1.x, pero sólo en la forma. El fondo sigue siendo el mismo: <strong>el navegador envía y recibe datos en formato JSON que mezcla con plantillas estáticas</strong> para  crear HTML en la máquina local y relajar al servidor. </p>
<p>Por cierto, por ahora ni rastro del viejo <code>$resource</code>. No tardará en aparecer una versión basada en <em>streams observables</em>. Sígueme en <a href="https://twitter.com/albertobasalo" target="_blank" rel="external">mi cuenta de twitter</a> o suscríbete a la <a href="http://academia-binaria.us4.list-manage.com/subscribe?u=c8ad2d2e7d02c26e32ce4cded&amp;id=b67e4d2339" target="_blank" rel="external">revista mensual de Academia Binaria</a> y en cuanto me entere serás el primero en ser informado.</p>
<p><em>Keep coding, keep learning.</em></p>

                    
                    <!-- Tags -->
                    
                        <div class="tags-container">
                            <div class="tags-sub-container">
                                <a class="fw3 ph1 dib" href="/academia-binaria-site/tags/Angular2/">#Angular2</a>
                            </div>
                        </div>
                    

                    <!-- Comments -->
                    



                </div>
                <div class="sidebar fl w-100 w-30-l center fw3 lh-copy pl4-ns tl black-50">
                    
                    <hr class="dn-l mw4 black-50 mt5" />
                    
                    <!-- Widget 1: About -->
                    <h1 class="mt5 mt0-l">
    <article class="dt db-l mw8 mw8-m mw5-ns center ml0-l mv3">
        <div class="dn dtc-m db-l v-mid tc pr4 pr0-l" style="min-width: 6rem;">
            <img src="/images/alberto-basalo-author.jpg" class="mb4-l br-100 h3 w3 h4-l w4-l dib" title="Alberto Basalo">
        </div>
        <p class="about-text dtc db-l v-mid lh-copy measure center f6 black-50 tj">
            ALBERTO BASALO
        </p>
    </article>
</h1>

                    <hr class="dn-l mw4 black-50 mt5" />

                    <!-- Widget 3: Recent Posts -->
                    <div class="mt5 tc tl-l">
    <h3>Artículos recientes</h3>
    
        <p>
            <a href="/academia-binaria-site/hello-world/">Hello World</a>
        </p>
    
        <p>
            <a href="/academia-binaria-site/typescript-programa-en-el-front-igual-que-en-el-back/">TypeScript, programa en el front igual que en el b</a>
        </p>
    
        <p>
            <a href="/academia-binaria-site/codigo-de-ejemplo-curso-de-angular2/">Código de ejemplo curso de Angular2</a>
        </p>
    
        <p>
            <a href="/academia-binaria-site/formularios-de-datos-en-angular2/">Formularios de datos en Angular2</a>
        </p>
    
        <p>
            <a href="/academia-binaria-site/comunicaciones-http-observables-con-angular2/">Comunicaciones http observables con Angular2</a>
        </p>
    
</div>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    document.addEventListener("DOMContentLoaded", function(event) {
        var contentElement = document.querySelector('.content');
        var sidebar = document.querySelector('.sidebar');
        var change = false;

        changePosition = function (position, top, right) {
            sidebar.style.setProperty('position', position);
            sidebar.style.setProperty('top', top);
            sidebar.style.setProperty('right', '150px');
        }

        changeSidebarPosition = function () {
            if (change) {
                changePosition('fixed', '0');
            } else {
                changePosition('unset', 'none');
            }
        }

        window.addEventListener('scroll', function(event) {
            if (contentElement.getBoundingClientRect().top <= 0) {
                if (!change) {
                    change = true;
                    changeSidebarPosition();
                }
            }
            if (contentElement.getBoundingClientRect().top >= 0) {
                if (change) {
                    change = false
                    changeSidebarPosition();
                }
            }
        });
    }); 
</script>

<!-- Footer -->
<div class="bg-1 ph2 ph5-ns pv5">
        <div class="mv8">
            <div class="center tc">
                
                    <div class="dib mh3">
                        <a class="f3 f2-ns white dim" href="https://twitter.com/?lang=en" target="_blank">
                            <i class="fa fa-twitter"></i>
                        </a>
                    </div>
                
                    <div class="dib mh3">
                        <a class="f3 f2-ns white dim" href="https://www.facebook.com/" target="_blank">
                            <i class="fa fa-facebook"></i>
                        </a>
                    </div>
                
                    <div class="dib mh3">
                        <a class="f3 f2-ns white dim" href="https://github.com/klugjo/hexo-theme-anodyne" target="_blank">
                            <i class="fa fa-github"></i>
                        </a>
                    </div>
                
                    <div class="dib mh3">
                        <a class="f3 f2-ns white dim" href="https://plus.google.com/" target="_blank">
                            <i class="fa fa-google-plus"></i>
                        </a>
                    </div>
                
                    <div class="dib mh3">
                        <a class="f3 f2-ns white dim" href="mailto:info@agorabinaria.com" target="_blank">
                            <i class="fa fa-envelope"></i>
                        </a>
                    </div>
                
                    <div class="dib mh3">
                        <a class="f3 f2-ns white dim" href="/#" target="_blank">
                            <i class="fa fa-rss"></i>
                        </a>
                    </div>
                
            </div>
            <div class="f6 f5-ns center tc white pt5 fw3">
                © 2017 Ágora Binaria. Av Primera C10, Edif Abanca Innova. CP: 15190, A Coruña
            </div>
        </div>
    </div>

<!-- After Footer -->
<!-- Disqus Comments -->



</body>

</html>