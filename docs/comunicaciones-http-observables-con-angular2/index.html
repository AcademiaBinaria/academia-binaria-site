<!DOCTYPE html><html lang="es"><head><meta charset="utf-8"><title>Comunicaciones http observables con Angular2 | Academia Binaria</title><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="description" content="ACTUALIZACIÓN: para una versión más reciente del contenido visita la página Comunicaciones HTTP en AngularEn AngularJS, y en otros frameworks del lado cliente, la idea de fue simple desde el principio"><meta name="keywords" content="Angular2,Tutorial,http"><meta property="og:type" content="article"><meta property="og:title" content="Comunicaciones http observables con Angular2"><meta property="og:url" content="https://academia-binaria.com/comunicaciones-http-observables-con-angular2/index.html"><meta property="og:site_name" content="Academia Binaria"><meta property="og:description" content="ACTUALIZACIÓN: para una versión más reciente del contenido visita la página Comunicaciones HTTP en AngularEn AngularJS, y en otros frameworks del lado cliente, la idea de fue simple desde el principio"><meta property="og:locale" content="es"><meta property="og:image" content="https://academia-binaria.com/css/images/angular.jpg"><meta property="og:updated_time" content="2017-02-16T16:44:21.000Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Comunicaciones http observables con Angular2"><meta name="twitter:description" content="ACTUALIZACIÓN: para una versión más reciente del contenido visita la página Comunicaciones HTTP en AngularEn AngularJS, y en otros frameworks del lado cliente, la idea de fue simple desde el principio"><meta name="twitter:image" content="https://academia-binaria.com/css/images/angular.jpg"><link rel="alternate" href="http://eepurl.com/b3p7fb" title="Academia Binaria" type="application/atom+xml"><link rel="icon" href="/css/images/favicon.ico"><link rel="stylesheet" href="/libs/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="/libs/open-sans/styles.css"><link rel="stylesheet" href="/libs/source-code-pro/styles.css"><link rel="stylesheet" href="/css/style.css"><script src="/libs/jquery/2.1.3/jquery.min.js"></script><script type="text/javascript">!function(e,a,t,n,g,c,o){e.GoogleAnalyticsObject="ga",e.ga=e.ga||function(){(e.ga.q=e.ga.q||[]).push(arguments)},e.ga.l=1*new Date,c=a.createElement(t),o=a.getElementsByTagName(t)[0],c.async=1,c.src="//www.google-analytics.com/analytics.js",o.parentNode.insertBefore(c,o)}(window,document,"script"),ga("create","UA-66674029-1","auto"),ga("send","pageview")</script></head></html><body><div id="container"><header id="header"><div id="header-main" class="header-inner"><div class="outer"><a href="/" id="logo"><i class="logo"></i> <span class="site-title">Academia Binaria</span></a><nav id="main-nav"><a class="main-nav-link" href="/tag/Angular">Tutorial para aprender Angular</a></nav><nav id="sub-nav"><div class="profile" id="profile-nav"><a id="profile-anchor" href="javascript:;"><img class="avatar" src="https://www.gravatar.com/avatar/c6ea942080cef8be6ff80ca095e718b8"> <i class="fa fa-caret-down"></i></a></div></nav><div id="search-form-wrap"><form class="search-form"><input type="text" class="ins-search-input search-form-input" placeholder="Buscar"> <button type="submit" class="search-form-submit"></button></form><div class="ins-search"><div class="ins-search-mask"></div><div class="ins-search-container"><div class="ins-input-wrapper"><input type="text" class="ins-search-input" placeholder="escribe..."> <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span></div><div class="ins-section-wrapper"><div class="ins-section-container"></div></div></div></div><script>window.INSIGHT_CONFIG={TRANSLATION:{POSTS:"Entradas",PAGES:"Páginas",CATEGORIES:"Categorias",TAGS:"Etiquetas",UNTITLED:"(Untitled)"},ROOT_URL:"/",CONTENT_URL:"/content.json"}</script><script src="/js/insight.js"></script></div></div></div><div id="main-nav-mobile" class="header-sub header-inner"><table class="menu outer"><tr><td><a class="main-nav-link" href="/tag/Angular">Tutorial para aprender Angular</a></td><td><div class="search-form"><input type="text" class="ins-search-input search-form-input" placeholder="Buscar"></div></td></tr></table></div></header><div class="outer"><aside id="profile"><div class="inner profile-inner"><div class="base-info profile-block"><img id="avatar" src="https://www.gravatar.com/avatar/c6ea942080cef8be6ff80ca095e718b8?s=128"><h2 id="name">Alberto Basalo</h2><h3 id="title">Formador y Consultor</h3><span id="location"><i class="fa fa-map-marker"></i>A Coruña, Spain</span> <a id="follow" target="_blank" href="https://twitter.com/albertobasalo">SEGUIR</a></div><div class="article-info profile-block"><div class="article-info-block"><a target="_blank" href="http://referral.pluralsight.com/mQe488E">Oferta</a></div><div class="article-info-block"><a target="_blank" href="http://eepurl.com/b3p7fb">News</a></div></div><div class="profile-block social-links"><table><tr><td><a href="https://github.com/AcademiaBinaria" target="_blank" title="github" class="tooltip"><i class="fa fa-github"></i></a></td><td><a href="https://twitter.com/albertobasalo" target="_blank" title="twitter" class="tooltip"><i class="fa fa-twitter"></i></a></td><td><a href="https://www.facebook.com/Agora.Binaria.SL/" target="_blank" title="facebook" class="tooltip"><i class="fa fa-facebook"></i></a></td><td><a href="http://eepurl.com/b3p7fb" target="_blank" title="rss" class="tooltip"><i class="fa fa-rss"></i></a></td></tr></table></div></div></aside><section id="main"><article id="post-comunicaciones-http-observables-con-angular2" class="article article-type-post" itemscope itemprop="blogPost"><div class="article-inner"><header class="article-header"><h1 class="article-title" itemprop="name">Comunicaciones http observables con Angular2</h1><div class="article-meta"><div class="article-date"><i class="fa fa-calendar"></i> <a href="/comunicaciones-http-observables-con-angular2/"><time datetime="2016-06-16T09:47:28.000Z" itemprop="datePublished">16-06-2016</time></a></div><div class="article-category"><i class="fa fa-folder"></i> <a class="article-category-link" href="/categories/Introduccion/">Introducción</a></div><div class="article-tag"><i class="fa fa-tag"></i> <a class="tag-link" href="/tag/Angular2/">Angular2</a>, <a class="tag-link" href="/tag/Tutorial/">Tutorial</a>, <a class="tag-link" href="/tag/http/">http</a></div></div></header><div class="article-entry" itemprop="articleBody"><blockquote><p>ACTUALIZACIÓN: para una versión más reciente del contenido visita la página <a href="../comunicaciones-http-en-Angular/">Comunicaciones HTTP en Angular</a></p></blockquote><hr><p>En AngularJS, y en otros frameworks del lado cliente, la idea de fue simple desde el principio: dame <strong>plantillas estáticas y datos dinámicos</strong>. Las comunicaciones <em>http</em> son las arterias vitales de transporte de esos datos dinámicos. Y en Angular 2 se han revisado por completo, llevando las comunicaciones asíncronas al siguiente nivel.</p><a id="more"></a><h3 id="La-libreria-http-y-otras…"><a href="#La-libreria-http-y-otras…" class="headerlink" title="La librería http y otras…"></a>La librería http y otras…</h3><p>Como cabe esperar Angular 2 dispone de su propio módulo de comunicaciones. En la librería <code>@angular/http</code> encontramos el nuevo servicio <code>http</code> que es el cliente usado para enviar y recibir datos.</p><p>Lo realmente novedoso viene de parte del proyecto <a href="http://reactivex.io/rxjs/" target="_blank" rel="external">Reactive Extensions o RxJS</a>. En su librería <code>rxjs/Observable</code> exporta la clase <code>Observable</code>. Esta clase implementa el <strong>patrón observador aplicado a streams</strong> de datos. El equipo de Angular ha decidido adoptarlo para procesar los <em>streams</em> de entrada y salida de datos <em>http</em>.</p><p>Un servicio típico que necesite comunicaciones con el servidor importará al menos estos objetos.</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Importar objetos de la librería http</span></div><div class="line"><span class="keyword">import</span> &#123; Http, Response, RequestOptions, Headers &#125; <span class="keyword">from</span> <span class="string">'@angular/http'</span>;</div><div class="line"><span class="comment">// Importar la clase Observable desde la librería rxjs</span></div><div class="line"><span class="keyword">import</span> &#123; Observable &#125;     <span class="keyword">from</span> <span class="string">'rxjs/Observable'</span>;</div></pre></td></tr></table></figure><p>Los servicios importados han de ser <strong>registrados como <em>providers</em> para poder ser inyectados como dependencias</strong> antes de ser consumidos. Ya que se trata de servicios de amplio uso en cualquier aplicación, se recomienda registrarlos en módulos de alto nivel. De esa forma pueden ser reutilizados como <em>singletons</em>.</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// importar la constante con los proveedores de http</span></div><div class="line"><span class="keyword">import</span> &#123; HttpModule, Http &#125; <span class="keyword">from</span> <span class="string">'@angular/http'</span>;</div><div class="line"></div><div class="line"><span class="meta">@NgModule</span>(&#123;</div><div class="line">  declarations: [ ],</div><div class="line">  imports: [</div><div class="line">    HttpModule, <span class="comment">// El módulo con todo lo necesario</span></div><div class="line">  ],</div><div class="line">  providers:[</div><div class="line">    Http, <span class="comment">// El servicio proveedor</span></div><div class="line">  ]</div><div class="line">&#125;);</div></pre></td></tr></table></figure><p>A partir de ese momento cualquier componente o servicio puede reclamar su inyección en el constructor, y lo podrá usar en sus propios métodos.<br></p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment">* Constructor que reclama dependencias inyectables</span></div><div class="line"><span class="comment">* Http se encuentra por haberse registrado en este módulo o en uno superior</span></div><div class="line"><span class="comment">**/</span></div><div class="line"><span class="keyword">constructor</span>(<span class="params"><span class="keyword">private</span> http: Http</span>) &#123;</div><div class="line">   <span class="comment">// en el constructor no debe contener lógica extra</span></div><div class="line">   <span class="comment">// su función es únicamente recibir las dependencias</span></div><div class="line">&#125;</div></pre></td></tr></table></figure><p></p><h3 id="Observables-en-lugar-de-promesas"><a href="#Observables-en-lugar-de-promesas" class="headerlink" title="Observables en lugar de promesas"></a>Observables en lugar de promesas</h3><p>La naturaleza asíncrona de las comunicaciones entre maquinas se implementó mediante <em>callbacks</em> en JavaScript. Esta forma de programar degenera en código difícil de mantener. Con el tiempo el <strong>patrón promesa</strong> se impuso, y en AngularJS 1.x es la manera recomendada de programar.</p><p>Pero las promesas también tiene sus limitaciones, y ahí aparecen los <strong>observables</strong>. Este patrón requerirá un artículo para el sólo, pero como adelanto se resume en lo siguiente:</p><blockquote><p>Tratar todo tipo de información como un stream observable de entrada y de salida, al cual se le pueden agregar operaciones que procesan los flujos de datos.</p></blockquote><p>Esto encaja muy bien con las comunicaciones <em>http</em> asíncronas y es la razón de su adopción en Angular 2. Un método de servicio par <strong>leer datos REST</strong> se parecerá a este <em>snippet</em>:</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// las llamadas devuelven observables</span></div><div class="line">leerDatos(): Observable&lt;Response&gt; &#123;</div><div class="line">  <span class="comment">// Se declara cómo va a ser la llamada </span></div><div class="line">  <span class="comment">// ocultando los pormenores a los consumidores   </span></div><div class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.http</div><div class="line">    .get(<span class="string">`<span class="subst">$&#123;this.urlBase&#125;</span>/recurso`</span>);</div><div class="line">  <span class="comment">// En este momento aún no se efectuó la llamada</span></div><div class="line">&#125;</div></pre></td></tr></table></figure><p>Para enviar información via <em>post</em> o <em>put</em> usaremos una estrategia similar, pero con unos requisitos específicos. En Angular 2 se requiere una configuración previa de las llamadas de escritura. Es engorroso pero fácilmente automatizable. Una típica operación de <strong>escritura REST</strong> sería algo así:</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">escribirDatos(unDato): Observable&lt;Response&gt; &#123;</div><div class="line">  <span class="comment">// Los envíos de información deben configurarse a mano</span></div><div class="line">  <span class="comment">// esto es fácilmente generalizable y reutilizable</span></div><div class="line">  <span class="keyword">let</span> body = <span class="built_in">JSON</span>.stringify(unDato);</div><div class="line">  <span class="keyword">let</span> headers = <span class="keyword">new</span> Headers(&#123; <span class="string">'Content-Type'</span>: <span class="string">'application/json'</span> &#125;);</div><div class="line">  <span class="keyword">let</span> options = <span class="keyword">new</span> RequestOptions(&#123; headers: headers &#125;);</div><div class="line">  <span class="comment">// declarar la llamada y retornar el observable</span></div><div class="line">  <span class="comment">// las variables de configuración y los datos, van como parámetros</span></div><div class="line">  <span class="keyword">if</span> (unDato._id) &#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.http</div><div class="line">      .put(<span class="string">`<span class="subst">$&#123;this.urlBase&#125;</span>/recurso/<span class="subst">$&#123;unDato._id&#125;</span>`</span>, body, options);</div><div class="line">  &#125; <span class="keyword">else</span> &#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.http</div><div class="line">      .post(<span class="string">`<span class="subst">$&#123;this.urlBase&#125;</span>/recurso`</span>, body, options);</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>Por supuesto esto es lo que se programa a bajo nivel, en los <strong>servicios de comunicaciones</strong>. En Angular2 se mantiene la recomendación de bajar a servicios la responsabilidad de las comunicaciones al tiempo que dejamos los componentes lo más ligeros posible.</p><p>Por encima de los servicios de comunicaciones habrá otros servicios de lógica o directamente componentes. En cualquier caso, los consumidores llamarán a métodos que siempre les devolverán objetos observables. Las clases de alto nivel se <strong>suscribirán a esos observables</strong> y procesarán la respuesta recibida… cuando esta esté disponible.</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// La carga de datos se hace al iniciarse el componente</span></div><div class="line"><span class="comment">// este es el lugar donde programar lógica de inicio</span></div><div class="line"><span class="comment">// nunca en el constructor</span></div><div class="line">ngOnInit() &#123;</div><div class="line">  <span class="comment">// en el momento de la suscripción es cuando se dispara la llamada</span></div><div class="line">  <span class="keyword">this</span>.datosService</div><div class="line">    .leerDatos()</div><div class="line">    .subscribe(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</div><div class="line">      <span class="keyword">this</span>.datos = res.json();</div><div class="line">    &#125;);</div><div class="line">  <span class="comment">// Sería similar en procesos de escritura</span></div><div class="line">&#125;</div></pre></td></tr></table></figure><blockquote><p>La clase <code>http</code> no realiza la llamada hasta que algún consumidor se suscriba a la respuesta. Mientras tanto queda como una definición congelada.</p></blockquote><p>El método <code>.subscribe()</code> recibe como argumento un puntero a la respuesta <em>http</em>. Los datos se encuentran en formato <em>JSON</em> y hay que reclamarlos mediante el método <code>.json()</code></p><h3 id="Extensiones-en-lugar-de-interceptores"><a href="#Extensiones-en-lugar-de-interceptores" class="headerlink" title="Extensiones en lugar de interceptores"></a>Extensiones en lugar de interceptores</h3><p>Una de las características destacables de los servicios <code>$http</code> de AngularJS 1.x era la posibilidad de usar <em>interceptores</em>. Estos eran <strong>funciones que se incrustaban durante el envío o recepción</strong> de las comunicaciones.</p><p>Un uso habitual era emplearlos para agregar <strong>cabeceras de seguridad o controlar errores</strong> de comunicación de manera centralizada. Ahora la forma recomendable de hacer eso mismo en Angular2 es mejorar el servicio http extendiéndolo. El servicio derivado resultante implementará los interceptores en funciones llamadas durante la comunicación.</p><p>Esta es una posible implementación con funcionalidad suficiente para facilitar los envíos, detectar errores y enviar cabeceras de seguridad.<br></p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Injectable</span>()</div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Extensión personalizada de la clase HTTP</span></div><div class="line"><span class="comment"> * Permite la configuración de todas las peticiones</span></div><div class="line"><span class="comment"> * Captura los envíos y respuestas</span></div><div class="line"><span class="comment"> * */</span></div><div class="line"><span class="keyword">export</span> <span class="keyword">class</span> HttpService <span class="keyword">extends</span> Http &#123;</div><div class="line">  <span class="comment">/** Las direcciones base deberían venir de la configuración del environment*/</span></div><div class="line">  <span class="keyword">public</span> apiProxyUrl = <span class="string">'http://localhost:4030/api/'</span>;</div><div class="line">  <span class="keyword">private</span> authorization = <span class="string">''</span>;</div><div class="line"></div><div class="line">  <span class="keyword">constructor</span>(<span class="params"></span></div><div class="line"><span class="params">    backend: XHRBackend,</span></div><div class="line"><span class="params">    defaultOptions: RequestOptions,</span></div><div class="line"><span class="params">    <span class="keyword">private</span> router: Router,</span></div><div class="line"><span class="params">    <span class="keyword">private</span> userStore: SessionStoreService</span></div><div class="line"><span class="params">  </span>) &#123;</div><div class="line">    <span class="keyword">super</span>(backend, defaultOptions);</div><div class="line">    <span class="keyword">this</span>.subscribeToToken();</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="comment">/**</span></div><div class="line"><span class="comment">   * Reescribe el método de la clase base, ejecutando acciones para cada petición</span></div><div class="line"><span class="comment">   * La peticiíón en curso puede llegar como una ruta o una clase request</span></div><div class="line"><span class="comment">   * Si viene sólo la cadena, debería traer las opciones aparte</span></div><div class="line"><span class="comment">   * */</span></div><div class="line">  request(request: <span class="built_in">string</span> | Request, options: RequestOptionsArgs = &#123; headers: <span class="keyword">new</span> Headers() &#125;): Observable&lt;Response&gt; &#123;</div><div class="line">    <span class="keyword">this</span>.configureRequest(request, options);</div><div class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.interceptResponse(request, options);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="keyword">private</span> subscribeToToken() &#123;</div><div class="line">    <span class="comment">// suponemos un servicio que nos avisa de la recepción de tokens</span></div><div class="line">    <span class="keyword">this</span>.userStore</div><div class="line">      .getDataObservable()</div><div class="line">      .subscribe(<span class="function">(<span class="params">data: Session</span>) =&gt;</span> <span class="keyword">this</span>.authorization = <span class="string">'Bearer '</span> + data.token);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="keyword">private</span> configureRequest(request: <span class="built_in">string</span> | Request, options: RequestOptionsArgs) &#123;</div><div class="line">    <span class="comment">// Adapta la ruta y asigna cabeceras</span></div><div class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> request === <span class="string">'string'</span>) &#123;</div><div class="line">      request = <span class="keyword">this</span>.getProxyUrl(request);</div><div class="line">      <span class="keyword">this</span>.setHeaders(options);</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">      request[<span class="string">'url'</span>] = <span class="keyword">this</span>.getProxyUrl(request[<span class="string">'url'</span>]);</div><div class="line">      <span class="keyword">this</span>.setHeaders(request);</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="keyword">private</span> interceptResponse(request: <span class="built_in">string</span> | Request, options: RequestOptionsArgs) : Observable&lt;Response&gt; &#123;</div><div class="line">    <span class="keyword">const</span> observableRequest = <span class="keyword">super</span></div><div class="line">      .request(request, options)</div><div class="line">      .catch(<span class="keyword">this</span>.onCatch())</div><div class="line">      .finally(<span class="keyword">this</span>.onFinally());</div><div class="line">    <span class="keyword">return</span> observableRequest;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="comment">/**</span></div><div class="line"><span class="comment">   * Transforma la url para llamar a trave´s de un proxy </span></div><div class="line"><span class="comment">   * Útil en caso de problemas con el CORS</span></div><div class="line"><span class="comment">   */</span></div><div class="line">  <span class="keyword">private</span> getProxyUrl(currentUrl) &#123;</div><div class="line">    <span class="keyword">if</span> (!currentUrl.includes(<span class="string">'/assets/'</span>)) &#123;</div><div class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.apiProxyUrl + currentUrl;</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">      <span class="keyword">return</span> currentUrl;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="comment">/**</span></div><div class="line"><span class="comment">   * Interceptor para componer las cabeceras en cada petición</span></div><div class="line"><span class="comment">   * */</span></div><div class="line">  <span class="keyword">private</span> setHeaders(objectToSetHeadersTo: Request | RequestOptionsArgs) &#123;</div><div class="line">    <span class="keyword">const</span> headers = objectToSetHeadersTo.headers;</div><div class="line">    headers.set(<span class="string">'Content-Type'</span>, <span class="string">'application/json'</span>);</div><div class="line">    headers.set(<span class="string">'Authorization'</span>, <span class="keyword">this</span>.authorization);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="comment">/**</span></div><div class="line"><span class="comment">   * Interceptor para captura genérica de errores http</span></div><div class="line"><span class="comment">   * */</span></div><div class="line">  <span class="keyword">private</span> onCatch() &#123;</div><div class="line">    <span class="keyword">return</span> <span class="function">(<span class="params">res: Response</span>) =&gt;</span> &#123;</div><div class="line">      <span class="comment">// Security errors</span></div><div class="line">      <span class="keyword">if</span> (res.status === <span class="number">401</span> || res.status === <span class="number">403</span>) &#123;</div><div class="line">        <span class="comment">// redirigir al usuario para pedir credenciales</span></div><div class="line">        <span class="keyword">this</span>.router.navigate([<span class="string">'user/login'</span>]);</div><div class="line">      &#125;</div><div class="line">      <span class="comment">// To Do: Gestión común de otros errores...</span></div><div class="line">      <span class="keyword">return</span> Observable.throw(res);</div><div class="line">    &#125;;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="keyword">private</span> onFinally() &#123;</div><div class="line">    <span class="keyword">return</span> <span class="function"><span class="params">()</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">'Fin'</span>);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure><p></p><p>Podemos usarlo de manera transparente en el resto de la aplicación. Sólo se necesita ajustar el registro de proveedores para dirigir al inyector de dependencias hacia esta nueva clase.<br></p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"> providers: [</div><div class="line">  &#123;</div><div class="line">    provide: Http, <span class="comment">// reemplaza el servicio del framework</span></div><div class="line">    useClass: HttpService <span class="comment">// con la clase personalizada que lo extiende</span></div><div class="line">  &#125;</div><div class="line">]</div></pre></td></tr></table></figure><p></p><blockquote><p>Este es uno de los usos más potentes de la inversión de control en Angular. Es el programador integrador el que decide el servicio a usar. El programador funcional declara la dependencia en los constructores de sus componentes y servicios, pero no decide la instancia concreta que recibirá.</p></blockquote><p>Angular 2 ha trastocado todo lo que hacíamos en las versiones 1.x, pero sólo en la forma. El fondo sigue siendo el mismo: <strong>el navegador envía y recibe datos en formato JSON que mezcla con plantillas estáticas</strong> para crear HTML en la máquina local y relajar al servidor.</p><p>Por cierto, por ahora ni rastro del viejo <code>$resource</code>. No tardará en aparecer una versión basada en <em>streams observables</em>. Sígueme en <a href="https://twitter.com/albertobasalo" target="_blank" rel="external">mi cuenta de twitter</a> o suscríbete a la <a href="http://academia-binaria.us4.list-manage.com/subscribe?u=c8ad2d2e7d02c26e32ce4cded&amp;id=b67e4d2339" target="_blank" rel="external">revista mensual de Academia Binaria</a> y en cuanto me entere serás el primero en ser informado.</p><blockquote><p>Aprender, programar, disfrutar, repetir.<br>– <cite>Saludos, Alberto Basalo</cite></p></blockquote><hr><h3 id="ACTUALIZACION"><a href="#ACTUALIZACION" class="headerlink" title="ACTUALIZACIÓN"></a>ACTUALIZACIÓN</h3><p>Para una versión más reciente del contenido visita la página <a href="../comunicaciones-http-en-Angular/">Comunicaciones HTTP en Angular</a></p></div><footer class="article-footer"><div class="share-container"></div><a data-url="https://academia-binaria.com/comunicaciones-http-observables-con-angular2/" data-id="cjbrwpvf6000ciwd3yh7x0xku" class="article-share-link"><i class="fa fa-share"></i>Compartir</a><script>!function(n){"undefined"!=typeof __SHARE_BUTTON_BINDED__&&__SHARE_BUTTON_BINDED__||(__SHARE_BUTTON_BINDED__=!0,n("body").on("click",function(){n(".article-share-box.on").removeClass("on")}).on("click",".article-share-link",function(t){t.stopPropagation();var e,a=n(this),o=a.attr("data-url"),i=encodeURIComponent(o),r="article-share-box-"+a.attr("data-id"),s=a.offset();if(n("#"+r).length){if((e=n("#"+r)).hasClass("on"))return void e.removeClass("on")}else{var l=['<div id="'+r+'" class="article-share-box">','<input class="article-share-input" value="'+o+'">','<div class="article-share-links">','<a href="https://twitter.com/intent/tweet?url='+i+'" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>','<a href="https://www.facebook.com/sharer.php?u='+i+'" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>','<a href="http://pinterest.com/pin/create/button/?url='+i+'" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>','<a href="https://plus.google.com/share?url='+i+'" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',"</div>","</div>"].join("");e=n(l),n("body").append(e)}n(".article-share-box.on").hide(),e.css({top:s.top+25,left:s.left}).addClass("on")}).on("click",".article-share-box",function(t){t.stopPropagation()}).on("click",".article-share-box-input",function(){n(this).select()}).on("click",".article-share-box-link",function(t){t.preventDefault(),t.stopPropagation(),window.open(this.href,"article-share-box-window-"+Date.now(),"width=500,height=450")}))}(jQuery)</script><a href="https://academia-binaria.com/comunicaciones-http-observables-con-angular2/#comments" class="article-comment-link disqus-comment-count" data-disqus-url="https://academia-binaria.com/comunicaciones-http-observables-con-angular2/">Comentarios</a> <a href="http://referral.pluralsight.com/mQe488E">Descuento en cursos PluralSight</a></footer></div><nav id="article-nav"><a href="/formularios-de-datos-en-angular2/" id="article-nav-newer" class="article-nav-link-wrap"><strong class="article-nav-caption">Reciente</strong><div class="article-nav-title">Formularios de datos en Angular2</div></a><a href="/enrutado-con-angular2-el-nuevo-spa/" id="article-nav-older" class="article-nav-link-wrap"><strong class="article-nav-caption">Antiguo</strong><div class="article-nav-title">Enrutador de componentes con Angular2 el nuevo SPA</div></a></nav></article><section id="comments"><div id="disqus_thread"><noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div></section></section><aside id="sidebar"><div class="widget-wrap"><h3 class="widget-title">Recientes</h3><div class="widget"><ul id="recent-post"><li><div class="item-thumbnail"><a href="/velocidad-y-seo-con-el-ssr-de-angular-universal/" class="thumbnail"><span style="background-image:url(/css/images/angular-c_universal.png)" alt="Velocidad y SEO con el SSR de Angular Universal" class="thumbnail-image"></span></a></div><div class="item-inner"><p class="item-category"><a class="article-category-link" href="/categories/Tutorial/">Tutorial</a><i class="fa fa-angle-right"></i><a class="article-category-link" href="/categories/Tutorial/Angular/">Angular</a></p><p class="item-title"><a href="/velocidad-y-seo-con-el-ssr-de-angular-universal/" class="title">Velocidad y SEO con el SSR de Angular Universal</a></p><p class="item-date"><time datetime="2018-10-30T11:50:27.000Z" itemprop="datePublished">30-10-2018</time></p></div></li><li><div class="item-thumbnail"><a href="/pwa-entre-la-web-y-las-apps-con-angular/" class="thumbnail"><span style="background-image:url(/css/images/angular-b_pwa.png)" alt="PWA, Entre la web y las apps con Angular" class="thumbnail-image"></span></a></div><div class="item-inner"><p class="item-category"><a class="article-category-link" href="/categories/Tutorial/">Tutorial</a><i class="fa fa-angle-right"></i><a class="article-category-link" href="/categories/Tutorial/Angular/">Angular</a></p><p class="item-title"><a href="/pwa-entre-la-web-y-las-apps-con-angular/" class="title">PWA, Entre la web y las apps con Angular</a></p><p class="item-date"><time datetime="2018-10-15T10:50:27.000Z" itemprop="datePublished">15-10-2018</time></p></div></li><li><div class="item-thumbnail"><a href="/el-patron-redux-con-ngrx-en-angular/" class="thumbnail"><span style="background-image:url(/css/images/angular-a_redux.png)" alt="El patrón Redux con NgRx en Angular" class="thumbnail-image"></span></a></div><div class="item-inner"><p class="item-category"><a class="article-category-link" href="/categories/Tutorial/">Tutorial</a><i class="fa fa-angle-right"></i><a class="article-category-link" href="/categories/Tutorial/Angular/">Angular</a></p><p class="item-title"><a href="/el-patron-redux-con-ngrx-en-angular/" class="title">El patrón Redux con NgRx en Angular</a></p><p class="item-date"><time datetime="2018-10-08T10:50:27.000Z" itemprop="datePublished">08-10-2018</time></p></div></li><li><div class="item-thumbnail"><a href="/deteccion-del-cambio-en-Angular/" class="thumbnail"><span style="background-image:url(/css/images/angular-9_change.png)" alt="Detección del cambio en Angular" class="thumbnail-image"></span></a></div><div class="item-inner"><p class="item-category"><a class="article-category-link" href="/categories/Tutorial/">Tutorial</a><i class="fa fa-angle-right"></i><a class="article-category-link" href="/categories/Tutorial/Angular/">Angular</a></p><p class="item-title"><a href="/deteccion-del-cambio-en-Angular/" class="title">Detección del cambio en Angular</a></p><p class="item-date"><time datetime="2018-09-28T10:09:27.000Z" itemprop="datePublished">28-09-2018</time></p></div></li><li><div class="item-thumbnail"><a href="/formularios-reactivos-con-Angular/" class="thumbnail"><span style="background-image:url(/css/images/angular-8_reactive.png)" alt="Formularios reactivos con Angular" class="thumbnail-image"></span></a></div><div class="item-inner"><p class="item-category"><a class="article-category-link" href="/categories/Tutorial/">Tutorial</a><i class="fa fa-angle-right"></i><a class="article-category-link" href="/categories/Tutorial/Angular/">Angular</a></p><p class="item-title"><a href="/formularios-reactivos-con-Angular/" class="title">Formularios reactivos con Angular</a></p><p class="item-date"><time datetime="2018-09-26T08:59:27.000Z" itemprop="datePublished">26-09-2018</time></p></div></li></ul></div></div><div class="widget-wrap"><h3 class="widget-title">Categorias</h3><div class="widget"><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Avanzado/">Avanzado</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Introduccion/">Introducción</a><span class="category-list-count">14</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Opinion/">Opinión</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Tutorial/">Tutorial</a><span class="category-list-count">13</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Tutorial/Angular/">Angular</a><span class="category-list-count">13</span></li></ul></li></ul></div></div><div class="widget-wrap"><h3 class="widget-title">Nube de etiquetas</h3><div class="widget tagcloud"><a href="/tag/Angular/" style="font-size:17.5px">Angular</a> <a href="/tag/Angular2/" style="font-size:20px">Angular2</a> <a href="/tag/Angular6/" style="font-size:17.5px">Angular6</a> <a href="/tag/Angular7/" style="font-size:17.5px">Angular7</a> <a href="/tag/AngularJS/" style="font-size:12.5px">AngularJS</a> <a href="/tag/Avanzado/" style="font-size:15px">Avanzado</a> <a href="/tag/BackEnd/" style="font-size:10px">BackEnd</a> <a href="/tag/Bootstrap/" style="font-size:11.25px">Bootstrap</a> <a href="/tag/CLI/" style="font-size:13.75px">CLI</a> <a href="/tag/ChangeDetection/" style="font-size:10px">ChangeDetection</a> <a href="/tag/Components/" style="font-size:10px">Components</a> <a href="/tag/DI/" style="font-size:11.25px">DI</a> <a href="/tag/Forms/" style="font-size:12.5px">Forms</a> <a href="/tag/FrontEnd/" style="font-size:10px">FrontEnd</a> <a href="/tag/Introduccion/" style="font-size:16.25px">Introducción</a> <a href="/tag/MongoDB/" style="font-size:11.25px">MongoDB</a> <a href="/tag/NgRx/" style="font-size:10px">NgRx</a> <a href="/tag/NodeJS/" style="font-size:13.75px">NodeJS</a> <a href="/tag/Observables/" style="font-size:11.25px">Observables</a> <a href="/tag/PWA/" style="font-size:10px">PWA</a> <a href="/tag/Redux/" style="font-size:10px">Redux</a> <a href="/tag/Routing/" style="font-size:10px">Routing</a> <a href="/tag/RxJS/" style="font-size:10px">RxJS</a> <a href="/tag/SPA/" style="font-size:11.25px">SPA</a> <a href="/tag/SSR/" style="font-size:10px">SSR</a> <a href="/tag/Servicios/" style="font-size:10px">Servicios</a> <a href="/tag/Tutorial/" style="font-size:18.75px">Tutorial</a> <a href="/tag/TypeScript/" style="font-size:10px">TypeScript</a> <a href="/tag/Universal/" style="font-size:10px">Universal</a> <a href="/tag/http/" style="font-size:12.5px">http</a> <a href="/tag/reactiveForms/" style="font-size:10px">reactiveForms</a></div></div><div class="widget-wrap widget-list"><h3 class="widget-title">Links</h3><div class="widget"><ul><li><a href="http://eepurl.com/b3p7fb">Newsletter</a></li><li><a href="http://agorabinaria.com">Ágora Binaria</a></li><li><a href="http://referral.pluralsight.com/mQe488E">PluralSight</a></li></ul></div></div><div class="widget-wrap"><h3 class="widget-title">Archivos</h3><div class="widget"><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">octubre 2018</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">septiembre 2018</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">agosto 2018</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">marzo 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/09/">septiembre 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/06/">junio 2016</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/05/">mayo 2016</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">abril 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/03/">marzo 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/01/">enero 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/11/">noviembre 2015</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/08/">agosto 2015</a><span class="archive-list-count">4</span></li></ul></div></div><div id="toTop" class="fa fa-angle-up"></div></aside></div><footer id="footer"><div class="outer"><div id="footer-info" class="inner">&copy; 2018 Developed by <a target="_blank" href="http://agorabinaria.com">Ágora Binaria</a>.</div></div></footer><script>var disqus_config=function(){this.page.url="https://academia-binaria.com/comunicaciones-http-observables-con-angular2/",this.page.identifier="comunicaciones-http-observables-con-angular2"};!function(){var a=document,e=a.createElement("script");e.src="//academiabinaria.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(a.head||a.body).appendChild(e)}()</script><script src="/js/main.js"></script><script src="//load.sumome.com/" data-sumo-site-id="24f3eb649e85fa1f7db20b7fa344f42f381f65f8f86f7028766c55d313e73eb5" async></script></div></body>