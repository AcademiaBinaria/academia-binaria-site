<!DOCTYPE html><html lang="es"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="utf-8"><title>Tests unitarios con Jest y e2e con Cypress en Angular | Academia Binaria</title><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="description" content="Continuamos este tutorial de Angular Avanzado con el tema controvertido del testing. Sí, ya sé que todos deberíamos hacerlo siempre, pero también sé que no es cierto. Así que vamos a ponerle remedio e"><meta name="keywords" content="Angular,Angular8,Nx,Tutorial,Avanzado,Test,Jest,Cypress"><meta property="og:type" content="article"><meta property="og:title" content="Tests unitarios con Jest y e2e con Cypress en Angular"><meta property="og:url" content="https://academia-binaria.com/tests-unitarios-con-jest-y-e2e-con-cypress-en-Angular/index.html"><meta property="og:site_name" content="Academia Binaria"><meta property="og:description" content="Continuamos este tutorial de Angular Avanzado con el tema controvertido del testing. Sí, ya sé que todos deberíamos hacerlo siempre, pero también sé que no es cierto. Así que vamos a ponerle remedio e"><meta property="og:locale" content="es"><meta property="og:image" content="https://academia-binaria.com/css/images/angular-11_test.png"><meta property="og:updated_time" content="2019-09-23T11:19:50.724Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Tests unitarios con Jest y e2e con Cypress en Angular"><meta name="twitter:description" content="Continuamos este tutorial de Angular Avanzado con el tema controvertido del testing. Sí, ya sé que todos deberíamos hacerlo siempre, pero también sé que no es cierto. Así que vamos a ponerle remedio e"><meta name="twitter:image" content="https://academia-binaria.com/css/images/angular-11_test.png"><link rel="alternate" href="http://eepurl.com/b3p7fb" title="Academia Binaria" type="application/atom+xml"><link rel="icon" href="/css/images/favicon.ico"><link rel="stylesheet" href="/libs/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="/libs/open-sans/styles.css"><link rel="stylesheet" href="/libs/source-code-pro/styles.css"><link rel="stylesheet" href="/css/style.css"><script src="/libs/jquery/2.1.3/jquery.min.js"></script><script type="text/javascript">!function(e,a,t,n,g,c,o){e.GoogleAnalyticsObject="ga",e.ga=e.ga||function(){(e.ga.q=e.ga.q||[]).push(arguments)},e.ga.l=1*new Date,c=a.createElement(t),o=a.getElementsByTagName(t)[0],c.async=1,c.src="//www.google-analytics.com/analytics.js",o.parentNode.insertBefore(c,o)}(window,document,"script"),ga("create","UA-66674029-1","auto"),ga("send","pageview")</script><script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script>(adsbygoogle=window.adsbygoogle||[]).push({google_ad_client:"ca-pub-2476046955705301",enable_page_level_ads:!0})</script></head></html><body><div id="container"><header id="header"><div id="header-main" class="header-inner"><div class="outer"><a href="/" id="logo"><i class="logo"></i> <span class="site-title">Academia Binaria</span></a><nav id="main-nav"><a class="main-nav-link" href="/cursos">Cursos Online</a></nav><nav id="sub-nav"><div class="profile" id="profile-nav"><a id="profile-anchor" href="javascript:;"><img class="avatar" src="https://www.gravatar.com/avatar/c6ea942080cef8be6ff80ca095e718b8"> <i class="fa fa-caret-down"></i></a></div></nav><div id="search-form-wrap"><form class="search-form"><input type="text" class="ins-search-input search-form-input" placeholder="Buscar"> <button type="submit" class="search-form-submit"></button></form><div class="ins-search"><div class="ins-search-mask"></div><div class="ins-search-container"><div class="ins-input-wrapper"><input type="text" class="ins-search-input" placeholder="escribe..."> <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span></div><div class="ins-section-wrapper"><div class="ins-section-container"></div></div></div></div><script>window.INSIGHT_CONFIG={TRANSLATION:{POSTS:"Entradas",PAGES:"Páginas",CATEGORIES:"Categorias",TAGS:"Etiquetas",UNTITLED:"(Untitled)"},ROOT_URL:"/",CONTENT_URL:"/content.json"}</script><script src="/js/insight.js"></script></div></div></div><div id="main-nav-mobile" class="header-sub header-inner"><table class="menu outer"><tr><td><a class="main-nav-link" href="/cursos">Cursos Online</a></td><td><div class="search-form"><input type="text" class="ins-search-input search-form-input" placeholder="Buscar"></div></td></tr></table></div></header><div class="outer"><aside id="profile"><div class="inner profile-inner"><div class="base-info profile-block"><img id="avatar" src="https://www.gravatar.com/avatar/c6ea942080cef8be6ff80ca095e718b8?s=128"><h2 id="name">Alberto Basalo</h2><h3 id="title">Formador y Consultor</h3><span id="location"><i class="fa fa-map-marker"></i>A Coruña, Spain</span> <a id="follow" target="_blank" href="https://twitter.com/albertobasalo">SEGUIR</a></div><div class="article-info profile-block"><a href="https://angular.builders" style="align-content:center"><img src="/css/images/angular.builders_cuadrado.png" width="100%" height="auto" alt="Angular.Builders"></a></div><div class="profile-block social-links"><table><tr><td><a href="https://github.com/AcademiaBinaria" target="_blank" title="github" class="tooltip"><i class="fa fa-github"></i></a></td><td><a href="https://twitter.com/albertobasalo" target="_blank" title="twitter" class="tooltip"><i class="fa fa-twitter"></i></a></td><td><a href="https://www.facebook.com/Agora.Binaria.SL/" target="_blank" title="facebook" class="tooltip"><i class="fa fa-facebook"></i></a></td><td><a href="http://eepurl.com/b3p7fb" target="_blank" title="rss" class="tooltip"><i class="fa fa-rss"></i></a></td></tr></table></div></div></aside><section id="main"><article id="post-tests-unitarios-con-jest-y-e2e-con-cypress-en-Angular" class="article article-type-post" itemscope itemprop="blogPost"><div class="article-inner"><header class="article-header"><h1 class="article-title" itemprop="name">Tests unitarios con Jest y e2e con Cypress en Angular</h1><div class="article-meta"><div class="article-date"><i class="fa fa-calendar"></i> <a href="/tests-unitarios-con-jest-y-e2e-con-cypress-en-Angular/"><time datetime="2019-09-05T12:25:12.000Z" itemprop="datePublished">05-09-2019</time></a></div><div class="article-category"><i class="fa fa-folder"></i> <a class="article-category-link" href="/categories/Tutorial/">Tutorial</a><i class="fa fa-angle-right"></i><a class="article-category-link" href="/categories/Tutorial/Angular/">Angular</a></div><div class="article-tag"><i class="fa fa-tag"></i> <a class="tag-link" href="/tag/Angular/">Angular</a>, <a class="tag-link" href="/tag/Angular8/">Angular8</a>, <a class="tag-link" href="/tag/Avanzado/">Avanzado</a>, <a class="tag-link" href="/tag/Cypress/">Cypress</a>, <a class="tag-link" href="/tag/Jest/">Jest</a>, <a class="tag-link" href="/tag/Nx/">Nx</a>, <a class="tag-link" href="/tag/Test/">Test</a>, <a class="tag-link" href="/tag/Tutorial/">Tutorial</a></div></div></header><div class="article-entry" itemprop="articleBody"><p><img src="/images/tutorial-angular-11_test.png" alt="tests-unitarios-con-jest-y-e2e-con-cypress-en-Angular"></p><p>Continuamos este <strong>tutorial de Angular Avanzado</strong> con el tema controvertido del testing. Sí, ya sé que todos deberíamos hacerlo siempre, pero también sé que no es cierto. Así que vamos a ponerle remedio eliminando excusas y facilitando las pruebas automatizadas.</p><blockquote><p>Por si hace falta su defensa: Las pruebas automáticas de código son la principal técnica de reducción de bugs y garantizan el buen funcionamiento durante un refactoring. Bueno para el usuario bueno para el programador.</p></blockquote><p>Los desarrollos que hoy en día hacemos con <strong>Angular</strong> suelen ser de tamaño medio o grande y con una esperanza de vida y mantenimiento que se mide en años. Así que cuantas más pruebas tengamos menos miedo tendremos a cambiar el código. Y la necesidad de cambio siempre estará ahí. Veremos como <em>Jest</em> y <em>Cypress</em> nos ayudan muchísimo en la tarea.</p><a id="more"></a><p>Partiendo del <a href="../nx-mono-repositorios-en-Angular">mono repositorio creado</a> usando las herramientas de <a href="https://nrwl.io/" target="_blank" rel="noopener">Nrwl.io/</a> aprovecharemos las herramientas que instala y configura dos productos de última generación que facilitan la tarea. Usaremos <a href="https://jestjs.io/" target="_blank" rel="noopener">Jest</a> para los test unitarios y <a href="https://www.cypress.io/" target="_blank" rel="noopener">Cypress</a> para los de integración <em>End to End</em>. Vamos a empezar por el final.</p><blockquote><p>Código asociado a este tutorial en <em>GitHub</em>: <a href="https://github.com/AcademiaBinaria/angular-boss" target="_blank" rel="noopener">AcademiaBinaria/angular-boss</a></p></blockquote><h2 id="Tabla-de-Contenido"><a href="#Tabla-de-Contenido" class="headerlink" title="Tabla de Contenido:"></a>Tabla de Contenido:</h2><p><a href="./#1.-Test-de-Integración-con-Cypress">1. Test de Integración con Cypress.</a></p><p><a href="./#2.-Test-Unitarios-con-Jest">2. Test Unitarios con Jest.</a></p><p><a href="./#Resumen">Resumen</a></p><hr><h1 id="1-Test-de-Integracion-con-Cypress"><a href="#1-Test-de-Integracion-con-Cypress" class="headerlink" title="1. Test de Integración con Cypress"></a>1. Test de Integración con Cypress</h1><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">As</span> <span class="attr">a:</span> <span class="string">developer,</span></span><br><span class="line">  <span class="string">I</span> <span class="attr">want:</span> <span class="string">to</span> <span class="string">test</span> <span class="string">end</span> <span class="string">to</span> <span class="string">end</span> <span class="string">my</span> <span class="string">app</span></span><br><span class="line">  <span class="string">so</span> <span class="attr">that:</span> <span class="string">I</span> <span class="string">can</span> <span class="string">be</span> <span class="string">sure</span> <span class="string">of</span> <span class="string">the</span> <span class="string">functions</span></span><br></pre></td></tr></table></figure><p>Las pruebas de integración son las que tienen un retorno de inversión más inmediato. Si esta es tu primera aproximación al testing, te recomiendo empezar por aquí. Se trata de definir un escenario y pre programar el comportamiento del usuario. El sistema lo ejecutará y podrás contrastar el resultado con algún valor esperado.</p><p>Son pruebas de caja negra que interactúan con el sistema en ejecución. Todo ello automatizado y con informes visuales interactivos o en ficheros de texto con el resultado de las pruebas.</p><h2 id="1-1-Cypress"><a href="#1-1-Cypress" class="headerlink" title="1.1 Cypress"></a>1.1 Cypress</h2><p><a href="https://www.cypress.io/" target="_blank" rel="noopener">Cypress</a> es el equivalente a Protractor, el producto propio de Angular. La ventaja principal es que no está atado a ningún framework y por tanto lo que hagas valdrá para probar cualquier web en cualquier tecnología.</p><p>Con cada aplicación generada se crea una hermana para sus pruebas <em>e2e</em>. Esa aplicación de pruebas está configurada y lista para compilar, servir y probar su aplicación objetivo. Con <a href="https://twitter.com/NxDevTools" target="_blank" rel="noopener">Nx</a> tenemos todo instalado, configurado y listo para ejecutarse con comandos como los siguientes que yo coloco en el <code>packcage.json</code>:</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"e2e:shop"</span>: <span class="string">"ng e2e shop-e2e --watch"</span>,</span><br><span class="line">  <span class="attr">"e2e:warehouse"</span>: <span class="string">"ng e2e warehouse-e2e --watch"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Luego se pueden lanzar desde la terminal muy cómodamente.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yarn e2e:shop</span><br><span class="line">yarn e2e:warehouse</span><br></pre></td></tr></table></figure><h2 id="1-2-Test-e2e"><a href="#1-2-Test-e2e" class="headerlink" title="1.2 Test e2e"></a>1.2 Test e2e</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">GIVEN:</span> <span class="string">the</span> <span class="string">shop</span> <span class="string">web</span> <span class="string">app</span></span><br><span class="line"><span class="attr">  WHEN:</span> <span class="string">user</span> <span class="string">visits</span> <span class="string">home</span> <span class="string">page</span></span><br><span class="line"><span class="attr">    THEN:</span> <span class="string">should</span> <span class="string">display</span> <span class="string">welcome</span> <span class="string">message</span></span><br><span class="line"><span class="attr">    THEN:</span> <span class="string">should</span> <span class="string">display</span> <span class="string">welcome</span> <span class="string">message</span> <span class="string">from</span> <span class="string">the</span> <span class="string">API</span></span><br></pre></td></tr></table></figure><p>Tu trabajo como <em>tester</em> será definir las pruebas en la carpeta <code>/integration</code>. Por ejemplo para empezar nos ofrecen el fichero <code>app-spec.ts</code> en el que yo he especificado el comportamiento deseado por mi página. La sintaxis se entiende por si misma. He seguido el convenio <strong>GIVEN, WHEN, THEN</strong> para especificar pruebas que podrían considerarse casi de comportamiento o aceptación.</p><p><code>apps\shop-e2e\src\integration\app.spec.ts</code></p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; getGreeting &#125; <span class="keyword">from</span> <span class="string">'../support/app.po'</span>;</span><br><span class="line"></span><br><span class="line">describe(<span class="string">'GIVEN: the shop web app'</span>, <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  beforeEach(<span class="function"><span class="params">()</span> =&gt;</span> cy.visit(<span class="string">'/'</span>));</span><br><span class="line">  context(<span class="string">'WHEN: user visits home page'</span>, <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    it(<span class="string">'THEN: should display welcome message'</span>, <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      getGreeting().contains(<span class="string">'Hello world'</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// needs the api server to run</span></span><br><span class="line">    <span class="comment">// yarn start:api</span></span><br><span class="line">    it(<span class="string">'THEN: should display welcome message from the API'</span>, <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      getGreeting().contains(<span class="string">'and Welcome to api!'</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>La parte más técnica y tediosa es la que accede al <em>DOM</em> y lo mejor es tener eso a parte. En la carpeta <code>/support</code> nos sugieren que creemos utilidades para tratar con el <em>DOM</em> y de esa forma mantener los test lo más cercanos posible a un lenguaje natural de negocio. En este caso uso una aproximación libre al <a href="https://www.genbeta.com/desarrollo/bdd-cucumber-y-gherkin-desarrollo-dirigido-por-comportamiento" target="_blank" rel="noopener">BDD con gherkin</a> para mantener el espíritu de sencillez de un tutorial sobre tecnología Angular, no sobre testing.</p><p><code>apps\shop-e2e\src\support\app.po.ts</code></p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getGreeting = <span class="function"><span class="params">()</span> =&gt;</span> cy.get(<span class="string">'h1'</span>);</span><br></pre></td></tr></table></figure><hr><h1 id="2-Test-Unitarios-con-Jest"><a href="#2-Test-Unitarios-con-Jest" class="headerlink" title="2. Test Unitarios con Jest"></a>2. Test Unitarios con Jest</h1><p>Las pruebas unitarias, muy asociadas al <a href="https://hackernoon.com/introduction-to-test-driven-development-tdd-61a13bc92d92" target="_blank" rel="noopener">TDD</a>, son las mejores amigas del desarrollador. Pero, también son las más engorrosas para empezar. Así que aquí veremos una introducción sencilla para que nadie deje de hacerlas.</p><h2 id="2-1-Jest"><a href="#2-1-Jest" class="headerlink" title="2.1 Jest"></a>2.1 Jest</h2><p><a href="https://jestjs.io/" target="_blank" rel="noopener">Jest</a> es un framework de testing para JavaScript muy sencillo y rápido. Puedes usarlo con cualquier otro framework. Para el caso de Angular ya viene preconfigurado si usas las extensiones Nx.</p><p>Mete los siguientes scripts en el <code>package.json</code> y así tendrás a mano siempre las pruebas. Te recomiendo que desarrolles con el test unitario lanzado; es la manera más rápida de probar el código que estés tocando. Idealmente incluso con el <a href="https://medium.com/javascript-scene/tdd-changed-my-life-5af0ce099f80" target="_blank" rel="noopener">test antes del código</a>.</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"test:shop"</span>: <span class="string">"ng test shop --watch --verbose"</span>,</span><br><span class="line">  <span class="attr">"test:warehouse"</span>: <span class="string">"ng test warehouse --watch --verbose"</span>,</span><br><span class="line">  <span class="attr">"test:api"</span>: <span class="string">"ng test api --watch --verbose"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yarn test:shop</span><br><span class="line">yarn test:warehouse</span><br><span class="line">yarn test:api</span><br></pre></td></tr></table></figure><h2 id="2-2-Tests-unitarios"><a href="#2-2-Tests-unitarios" class="headerlink" title="2.2 Tests unitarios"></a>2.2 Tests unitarios</h2><h3 id="2-2-1-Componentes"><a href="#2-2-1-Componentes" class="headerlink" title="2.2.1 Componentes"></a>2.2.1 Componentes</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">GIVEN:</span> <span class="string">an</span> <span class="string">AppComponent</span> <span class="string">declared</span> <span class="string">in</span> <span class="string">AppModule</span></span><br><span class="line"><span class="attr">  WHEN:</span> <span class="string">the</span> <span class="string">AppModule</span> <span class="string">is</span> <span class="string">compiled</span></span><br><span class="line"><span class="attr">    THEN:</span> <span class="string">should</span> <span class="string">create</span> <span class="string">the</span> <span class="string">component</span></span><br><span class="line"><span class="attr">    THEN:</span> <span class="string">should</span> <span class="string">have</span> <span class="string">a</span> <span class="string">property</span> <span class="string">title</span> <span class="string">with</span> <span class="string">value</span> <span class="string">'shop'</span></span><br><span class="line"><span class="attr">    THEN:</span> <span class="string">should</span> <span class="string">render</span> <span class="string">'Hello world'</span> <span class="string">in</span> <span class="string">a</span> <span class="string">H1</span> <span class="string">tag</span></span><br></pre></td></tr></table></figure><p>En este caso queremos probar una librería de componentes. Y empezamos por el componente raíz. Esta es una prueba unitarias pero con un toque de integración parcial pues necesita de otros componentes para ejecutarse. Cuanto más arriba en la jerarquía esté el componente mayor será su necesidad de integrar a otros. Pero no pasa nada, de esta forma te aseguras de que el módulo de la librería se importa y que sus componentes se exportan correctamente.</p><p>Al grano, vamos a la aplicación <em>shop</em> para comprobar que su componente <code>AppComponent</code> funciona y (de paso) que se renderiza también el componente <code>ab-ui-greetings</code> incrustando los saludos.</p><p><code>apps\shop\src\app\app.component.spec.ts</code></p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; UiModule &#125; <span class="keyword">from</span> <span class="string">'@a-boss/ui'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="keyword">async</span>, TestBed &#125; <span class="keyword">from</span> <span class="string">'@angular/core/testing'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; RouterTestingModule &#125; <span class="keyword">from</span> <span class="string">'@angular/router/testing'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; AppComponent &#125; <span class="keyword">from</span> <span class="string">'./app.component'</span>;</span><br><span class="line"></span><br><span class="line">describe(<span class="string">'GIVEN: an AppComponent declared in AppModule'</span>, <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  describe(<span class="string">'WHEN: the AppModule is compiled'</span>, <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    beforeEach(<span class="keyword">async</span>(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      TestBed.configureTestingModule(&#123;</span><br><span class="line">        imports: [RouterTestingModule, UiModule],</span><br><span class="line">        declarations: [AppComponent]</span><br><span class="line">      &#125;).compileComponents();</span><br><span class="line">    &#125;));</span><br><span class="line"></span><br><span class="line">    it(<span class="string">'THEN: should create the component'</span>, <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> fixture = TestBed.createComponent(AppComponent);</span><br><span class="line">      <span class="keyword">const</span> app = fixture.debugElement.componentInstance;</span><br><span class="line">      expect(app).toBeTruthy();</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    it(<span class="string">`THEN: should have a property title with value 'shop'`</span>, <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> fixture = TestBed.createComponent(AppComponent);</span><br><span class="line">      <span class="keyword">const</span> app = fixture.debugElement.componentInstance;</span><br><span class="line">      expect(app.title).toEqual(<span class="string">'shop'</span>);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    it(<span class="string">`THEN: should render 'Hello world' in a H1 tag`</span>, <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> fixture = TestBed.createComponent(AppComponent);</span><br><span class="line">      fixture.detectChanges();</span><br><span class="line">      <span class="keyword">const</span> compiled = fixture.debugElement.nativeElement;</span><br><span class="line">      expect(compiled.querySelector(<span class="string">'h1'</span>).textContent).toContain(<span class="string">'Hello world'</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="2-2-2-Services"><a href="#2-2-2-Services" class="headerlink" title="2.2.2 Services"></a>2.2.2 Services</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">GIVEN:</span> <span class="string">a</span> <span class="string">GreetingsService</span></span><br><span class="line"><span class="attr">  WHEN:</span> <span class="string">the</span> <span class="string">DataModule</span> <span class="string">is</span> <span class="string">compiled</span></span><br><span class="line"><span class="attr">    THEN:</span> <span class="string">should</span> <span class="string">be</span> <span class="string">created</span></span><br><span class="line"><span class="attr">    THEN:</span> <span class="string">should</span> <span class="string">return</span> <span class="string">an</span> <span class="string">observable</span> <span class="string">when</span> <span class="string">call</span> <span class="string">'getGrettings()'</span></span><br><span class="line"><span class="attr">    THEN:</span> <span class="string">should</span> <span class="string">return</span> <span class="string">'Welcome to api!'</span> <span class="string">when</span> <span class="string">call</span> <span class="string">'getGrettings()'</span></span><br></pre></td></tr></table></figure><p>La prueba de servicios es más sencilla que la de componentes pues no hay que tratar con la renderización del HTML; sólo funcionalidad en una clase TypeScript. Pero, siempre hay un pero, muchos de estos servicios tratarán con llamadas asíncronas. Afortunadamente está todo pensado y se resuelve con dos conceptos: la función <code>async()</code> y inyección de réplicas (<em>mocks</em>) de las dependencias.</p><p><code>libs\shared\data\src\lib\greetings\greetings.service.spec.ts</code></p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// importar réplicas para testing de las dependencias del servicio</span></span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  HttpClientTestingModule,</span><br><span class="line">  HttpTestingController</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">'@angular/common/http/testing'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="keyword">async</span>, TestBed &#125; <span class="keyword">from</span> <span class="string">'@angular/core/testing'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Observable &#125; <span class="keyword">from</span> <span class="string">'rxjs'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; GreetingsService &#125; <span class="keyword">from</span> <span class="string">'./greetings.service'</span>;</span><br><span class="line"></span><br><span class="line">describe(<span class="string">'GIVEN: a GreetingsService'</span>, <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  describe(<span class="string">'WHEN: the DataModule is compiled'</span>, <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    beforeEach(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      TestBed.configureTestingModule(&#123;</span><br><span class="line">        imports: [HttpClientTestingModule]</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    it(<span class="string">'THEN: should be created'</span>, <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> service: GreetingsService = TestBed.get(GreetingsService);</span><br><span class="line">      expect(service).toBeTruthy();</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    it(<span class="string">`THEN: should return an observable when call 'getGrettings()'`</span>, <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> service: GreetingsService = TestBed.get(GreetingsService);</span><br><span class="line">      <span class="keyword">const</span> greetings$: Observable&lt;<span class="built_in">any</span>&gt; = service.getGrettings$();</span><br><span class="line">      expect(greetings$).toBeInstanceOf(Observable);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Ojo al async para ejectuar las llamadas asíncronas</span></span><br><span class="line">    it(<span class="string">`THEN: should return 'Welcome to api!' when call 'getGrettings()'`</span>, <span class="keyword">async</span>(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> service: GreetingsService = TestBed.get(GreetingsService);</span><br><span class="line">      service</span><br><span class="line">        .getGrettings$()</span><br><span class="line">        .subscribe(<span class="function"><span class="params">result</span> =&gt;</span></span><br><span class="line">          expect(result).toEqual(&#123; message: <span class="string">'Welcome to api!'</span> &#125;)</span><br><span class="line">        );</span><br><span class="line">      <span class="comment">// mock del backend para no depender del servidor</span></span><br><span class="line">      <span class="keyword">const</span> httpMock = TestBed.get(HttpTestingController);</span><br><span class="line">      <span class="comment">// esperar a que se llame a esta ruta</span></span><br><span class="line">      <span class="keyword">const</span> req = httpMock.expectOne(<span class="string">'http://localhost:3333/api'</span>);</span><br><span class="line">      req.flush(&#123; message: <span class="string">'Welcome to api!'</span> &#125;); <span class="comment">// responder con esto</span></span><br><span class="line">      httpMock.verify(); <span class="comment">// comprobar que no hay más llmadas</span></span><br><span class="line">    &#125;));</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>A partir de aquí es siempre igual. Defines un respuesta esperada, le das una entrada conocida y si algo no cuadra, entonces el código no pasa la prueba y tienes una oportunidad para mejorarlo.</p><p>En la prueba de servicios es fundamental que uses réplicas de sus dependencias. Es la forma de garantizar que pruebas únicamente el servicio, sin depender de nada. Esto era mucho más complejo con los componentes, pero un mandamiento con los servicios.</p><hr><h2 id="Resumen"><a href="#Resumen" class="headerlink" title="Resumen"></a>Resumen</h2><p>En definitiva, los grandes desarrollos demandados por bancos, multinacionales o administración pública requieren soluciones fiables y mantenibles. Y eso pasa inexcusablemente por hacer testing. <strong>Angular</strong> facilita las pruebas unitarias y de integración; especialmente con las herramientas <em>Jest</em> y <em>Cypress</em> ya configuradas por <strong>NxDevTools</strong>.</p><p>Con este tutorial de formación <a href="../tag/Avanzado/">avanzada en Angular</a> te preparas para poder afrontar retos de tamaño industrial. Continúa aprendiendo a mejorar el rendimiento usando la <a href="../deteccion-del-cambio-en-Angular">detección del cambio en Angular</a>. Todos esos detalles se tratan en el <a href="https://www.trainingit.es/curso-angular-avanzado/?promo=angular.builders" target="_blank" rel="noopener">curso avanzado online</a> que imparto con TrainingIT o a medida para tu empresa.</p><blockquote><p>Aprender, programar, disfrutar, repetir.<br>– <cite>Saludos, Alberto Basalo</cite></p></blockquote></div><footer class="article-footer"><div class="share-container"></div><a data-url="https://academia-binaria.com/tests-unitarios-con-jest-y-e2e-con-cypress-en-Angular/" data-id="ck0qtfayz000irws3c1xbdp6h" class="article-share-link"><i class="fa fa-share"></i>Compartir</a><script>!function(n){"undefined"!=typeof __SHARE_BUTTON_BINDED__&&__SHARE_BUTTON_BINDED__||(__SHARE_BUTTON_BINDED__=!0,n("body").on("click",function(){n(".article-share-box.on").removeClass("on")}).on("click",".article-share-link",function(t){t.stopPropagation();var e,a=n(this),o=a.attr("data-url"),i=encodeURIComponent(o),r="article-share-box-"+a.attr("data-id"),s=a.offset();if(n("#"+r).length){if((e=n("#"+r)).hasClass("on"))return void e.removeClass("on")}else{var l=['<div id="'+r+'" class="article-share-box">','<input class="article-share-input" value="'+o+'">','<div class="article-share-links">','<a href="https://twitter.com/intent/tweet?url='+i+'" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>','<a href="https://www.facebook.com/sharer.php?u='+i+'" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>','<a href="http://pinterest.com/pin/create/button/?url='+i+'" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>','<a href="https://plus.google.com/share?url='+i+'" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',"</div>","</div>"].join("");e=n(l),n("body").append(e)}n(".article-share-box.on").hide(),e.css({top:s.top+25,left:s.left}).addClass("on")}).on("click",".article-share-box",function(t){t.stopPropagation()}).on("click",".article-share-box-input",function(){n(this).select()}).on("click",".article-share-box-link",function(t){t.preventDefault(),t.stopPropagation(),window.open(this.href,"article-share-box-window-"+Date.now(),"width=500,height=450")}))}(jQuery)</script></footer></div><nav id="article-nav"><a href="/nx-mono-repositorios-en-Angular/" id="article-nav-newer" class="article-nav-link-wrap"><strong class="article-nav-caption">Anterior</strong><div class="article-nav-title">Nx, mono repositorios en Angular</div></a><a href="/deteccion-del-cambio-en-Angular/" id="article-nav-older" class="article-nav-link-wrap"><strong class="article-nav-caption">Siguiente</strong><div class="article-nav-title">Detección del cambio en Angular</div></a></nav><p><a href="https://www.trainingit.es/curso-angular-basico/?promo=angular.builders">Código promo para: Curso online de introducción a Angular</a></p><hr><p><a href="https://www.trainingit.es/curso-angular-avanzado/?promo=angular.builders">Código promo para: Curso online avanzado con Angular</a></p><a href="https://angular.builders"><img src="/css/images/angular.builders.png" alt="Angular.Builders"></a><hr></article></section><aside id="sidebar"><div class="widget-wrap"><h3 class="widget-title">Recientes</h3><div class="widget"><ul id="recent-post"><li><div class="item-thumbnail"><a href="/pwa-entre-la-web-y-las-apps-con-angular/" class="thumbnail"><span style="background-image:url(/css/images/angular-b_pwa.png)" alt="PWA, Entre la web y las apps con Angular" class="thumbnail-image"></span></a></div><div class="item-inner"><p class="item-category"><a class="article-category-link" href="/categories/Tutorial/">Tutorial</a><i class="fa fa-angle-right"></i><a class="article-category-link" href="/categories/Tutorial/Angular/">Angular</a></p><p class="item-title"><a href="/pwa-entre-la-web-y-las-apps-con-angular/" class="title">PWA, Entre la web y las apps con Angular</a></p><p class="item-date"><time datetime="2019-10-03T17:50:27.000Z" itemprop="datePublished">03-10-2019</time></p></div></li><li><div class="item-thumbnail"><a href="/el-patron-redux-con-ngrx-en-angular/" class="thumbnail"><span style="background-image:url(/css/images/angular-a_redux.png)" alt="El patrón Redux con NgRx en Angular" class="thumbnail-image"></span></a></div><div class="item-inner"><p class="item-category"><a class="article-category-link" href="/categories/Tutorial/">Tutorial</a><i class="fa fa-angle-right"></i><a class="article-category-link" href="/categories/Tutorial/Angular/">Angular</a></p><p class="item-title"><a href="/el-patron-redux-con-ngrx-en-angular/" class="title">El patrón Redux con NgRx en Angular</a></p><p class="item-date"><time datetime="2019-09-25T11:08:50.000Z" itemprop="datePublished">25-09-2019</time></p></div></li><li><div class="item-thumbnail"><a href="/base-aplicacion-angular/" class="thumbnail"><span style="background-image:url(/css/images/angular-1_base.png)" alt="Base para una aplicación Angular" class="thumbnail-image"></span></a></div><div class="item-inner"><p class="item-category"><a class="article-category-link" href="/categories/Tutorial/">Tutorial</a><i class="fa fa-angle-right"></i><a class="article-category-link" href="/categories/Tutorial/Angular/">Angular</a></p><p class="item-title"><a href="/base-aplicacion-angular/" class="title">Base para una aplicación Angular</a></p><p class="item-date"><time datetime="2019-09-23T11:57:00.000Z" itemprop="datePublished">23-09-2019</time></p></div></li><li><div class="item-thumbnail"><a href="/hola-angular-cli/" class="thumbnail"><span style="background-image:url(/css/images/angular-0_cli.png)" alt="Hola Angular CLI" class="thumbnail-image"></span></a></div><div class="item-inner"><p class="item-category"><a class="article-category-link" href="/categories/Tutorial/">Tutorial</a><i class="fa fa-angle-right"></i><a class="article-category-link" href="/categories/Tutorial/Angular/">Angular</a></p><p class="item-title"><a href="/hola-angular-cli/" class="title">Hola Angular CLI</a></p><p class="item-date"><time datetime="2019-09-23T10:54:00.000Z" itemprop="datePublished">23-09-2019</time></p></div></li><li><div class="item-thumbnail"><a href="/flujo-reactivo-unidireccional-con-Angular-y-RxJs/" class="thumbnail"><span style="background-image:url(/css/images/angular-14_redux.png)" alt="Redux, flujo reactivo unidireccional con Angular y RxJs" class="thumbnail-image"></span></a></div><div class="item-inner"><p class="item-category"><a class="article-category-link" href="/categories/Tutorial/">Tutorial</a><i class="fa fa-angle-right"></i><a class="article-category-link" href="/categories/Tutorial/Angular/">Angular</a></p><p class="item-title"><a href="/flujo-reactivo-unidireccional-con-Angular-y-RxJs/" class="title">Redux, flujo reactivo unidireccional con Angular y RxJs</a></p><p class="item-date"><time datetime="2019-09-17T10:47:58.000Z" itemprop="datePublished">17-09-2019</time></p></div></li></ul></div></div><div class="widget-wrap"><h3 class="widget-title">Categorias</h3><div class="widget"><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Tutorial/">Tutorial</a><span class="category-list-count">18</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Tutorial/Angular/">Angular</a><span class="category-list-count">18</span></li></ul></li></ul></div></div><div class="widget-wrap"><h3 class="widget-title">Nube de etiquetas</h3><div class="widget tagcloud"><a href="/tag/Angular/" style="font-size:20px">Angular</a> <a href="/tag/Angular2/" style="font-size:17.5px">Angular2</a> <a href="/tag/Angular6/" style="font-size:10px">Angular6</a> <a href="/tag/Angular7/" style="font-size:11.25px">Angular7</a> <a href="/tag/Angular8/" style="font-size:18.75px">Angular8</a> <a href="/tag/AngularJS/" style="font-size:10px">AngularJS</a> <a href="/tag/Avanzado/" style="font-size:15px">Avanzado</a> <a href="/tag/BackEnd/" style="font-size:10px">BackEnd</a> <a href="/tag/CLI/" style="font-size:11.25px">CLI</a> <a href="/tag/ChangeDetection/" style="font-size:10px">ChangeDetection</a> <a href="/tag/Components/" style="font-size:10px">Components</a> <a href="/tag/Cypress/" style="font-size:10px">Cypress</a> <a href="/tag/DI/" style="font-size:10px">DI</a> <a href="/tag/Forms/" style="font-size:10px">Forms</a> <a href="/tag/FrontEnd/" style="font-size:10px">FrontEnd</a> <a href="/tag/Introduccion/" style="font-size:16.25px">Introducción</a> <a href="/tag/Jest/" style="font-size:10px">Jest</a> <a href="/tag/MongoDB/" style="font-size:10px">MongoDB</a> <a href="/tag/NgRx/" style="font-size:10px">NgRx</a> <a href="/tag/NodeJS/" style="font-size:13.75px">NodeJS</a> <a href="/tag/Nx/" style="font-size:11.25px">Nx</a> <a href="/tag/Observables/" style="font-size:13.75px">Observables</a> <a href="/tag/Opinion/" style="font-size:12.5px">Opinión</a> <a href="/tag/PWA/" style="font-size:10px">PWA</a> <a href="/tag/Redux/" style="font-size:11.25px">Redux</a> <a href="/tag/Routing/" style="font-size:10px">Routing</a> <a href="/tag/RxJS/" style="font-size:10px">RxJS</a> <a href="/tag/RxJs/" style="font-size:10px">RxJs</a> <a href="/tag/SPA/" style="font-size:10px">SPA</a> <a href="/tag/SSR/" style="font-size:10px">SSR</a> <a href="/tag/Servicios/" style="font-size:10px">Servicios</a> <a href="/tag/Template/" style="font-size:10px">Template</a> <a href="/tag/Test/" style="font-size:10px">Test</a> <a href="/tag/Tutorial/" style="font-size:20px">Tutorial</a> <a href="/tag/TypeScript/" style="font-size:10px">TypeScript</a> <a href="/tag/Universal/" style="font-size:10px">Universal</a> <a href="/tag/http/" style="font-size:11.25px">http</a> <a href="/tag/material/" style="font-size:10px">material</a> <a href="/tag/reactiveForms/" style="font-size:10px">reactiveForms</a></div></div><div class="widget-wrap widget-list"><h3 class="widget-title">Links</h3><div class="widget"><ul><li><a href="https://www.trainingit.es/curso-angular-basico/?promo=angular.builders">Intro</a></li><li><a href="https://www.trainingit.es/curso-angular-avanzado/?promo=angular.builders">Avanzado</a></li><li><a href="https://www.trainingit.es/curso-typescript/?promo=meetup10&af=abasalo">TypeScript</a></li><li><a href="http://referral.pluralsight.com/mQe488E">PluralSight</a></li></ul></div></div><div class="widget-wrap"><h3 class="widget-title">Archivos</h3><div class="widget"><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">octubre 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">septiembre 2019</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">marzo 2019</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">febrero 2019</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">enero 2019</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">octubre 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">marzo 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/05/">mayo 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">abril 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/03/">marzo 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/01/">enero 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/08/">agosto 2015</a><span class="archive-list-count">1</span></li></ul></div></div><div id="toTop" class="fa fa-angle-up"></div><div><a href="https://angular.builders" style="align-content:center"><img src="/css/images/angular.builders.png" width="100%" height="auto" alt="Angular.Builders"></a></div></aside></div><footer id="footer"><div class="outer"><div id="footer-info" class="inner">&copy; 2019 Developed by <a target="_blank" href="http://agorabinaria.com">Ágora Binaria</a>.</div></div></footer><script src="/js/main.js"></script><script src="//load.sumome.com/" data-sumo-site-id="24f3eb649e85fa1f7db20b7fa344f42f381f65f8f86f7028766c55d313e73eb5" async></script></div></body>