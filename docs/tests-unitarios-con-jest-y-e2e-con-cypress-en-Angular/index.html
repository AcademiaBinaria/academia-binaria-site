<!DOCTYPE html><html lang="es"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="utf-8"><title>Tests unitarios con Jest y e2e con Cypress en Angular | Academia Binaria</title><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="description" content="Continuamos este tutorial de Angular Avanzado con el tema controvertido del testing. Sí, ya sé que todos deberíamos hacerlo siempre, pero también sé que no es cierto. Así que vamos a ponerle remedio e"><meta name="keywords" content="Angular,Angular8,Nx,Tutorial,Avanzado,Test,Jest,Cypress"><meta property="og:type" content="article"><meta property="og:title" content="Tests unitarios con Jest y e2e con Cypress en Angular"><meta property="og:url" content="https://academia-binaria.com/tests-unitarios-con-jest-y-e2e-con-cypress-en-Angular/index.html"><meta property="og:site_name" content="Academia Binaria"><meta property="og:description" content="Continuamos este tutorial de Angular Avanzado con el tema controvertido del testing. Sí, ya sé que todos deberíamos hacerlo siempre, pero también sé que no es cierto. Así que vamos a ponerle remedio e"><meta property="og:locale" content="es"><meta property="og:image" content="https://academia-binaria.com/css/images/angular-11_test.png"><meta property="og:updated_time" content="2019-08-02T09:36:56.863Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Tests unitarios con Jest y e2e con Cypress en Angular"><meta name="twitter:description" content="Continuamos este tutorial de Angular Avanzado con el tema controvertido del testing. Sí, ya sé que todos deberíamos hacerlo siempre, pero también sé que no es cierto. Así que vamos a ponerle remedio e"><meta name="twitter:image" content="https://academia-binaria.com/css/images/angular-11_test.png"><link rel="alternate" href="http://eepurl.com/b3p7fb" title="Academia Binaria" type="application/atom+xml"><link rel="icon" href="/css/images/favicon.ico"><link rel="stylesheet" href="/libs/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="/libs/open-sans/styles.css"><link rel="stylesheet" href="/libs/source-code-pro/styles.css"><link rel="stylesheet" href="/css/style.css"><script src="/libs/jquery/2.1.3/jquery.min.js"></script><script type="text/javascript">!function(e,a,t,n,g,c,o){e.GoogleAnalyticsObject="ga",e.ga=e.ga||function(){(e.ga.q=e.ga.q||[]).push(arguments)},e.ga.l=1*new Date,c=a.createElement(t),o=a.getElementsByTagName(t)[0],c.async=1,c.src="//www.google-analytics.com/analytics.js",o.parentNode.insertBefore(c,o)}(window,document,"script"),ga("create","UA-66674029-1","auto"),ga("send","pageview")</script><script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script>(adsbygoogle=window.adsbygoogle||[]).push({google_ad_client:"ca-pub-2476046955705301",enable_page_level_ads:!0})</script></head></html><body><div id="container"><header id="header"><div id="header-main" class="header-inner"><div class="outer"><a href="/" id="logo"><i class="logo"></i> <span class="site-title">Academia Binaria</span></a><nav id="main-nav"><a class="main-nav-link" href="/cursos">Cursos Online</a></nav><nav id="sub-nav"><div class="profile" id="profile-nav"><a id="profile-anchor" href="javascript:;"><img class="avatar" src="https://www.gravatar.com/avatar/c6ea942080cef8be6ff80ca095e718b8"> <i class="fa fa-caret-down"></i></a></div></nav><div id="search-form-wrap"><form class="search-form"><input type="text" class="ins-search-input search-form-input" placeholder="Buscar"> <button type="submit" class="search-form-submit"></button></form><div class="ins-search"><div class="ins-search-mask"></div><div class="ins-search-container"><div class="ins-input-wrapper"><input type="text" class="ins-search-input" placeholder="escribe..."> <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span></div><div class="ins-section-wrapper"><div class="ins-section-container"></div></div></div></div><script>window.INSIGHT_CONFIG={TRANSLATION:{POSTS:"Entradas",PAGES:"Páginas",CATEGORIES:"Categorias",TAGS:"Etiquetas",UNTITLED:"(Untitled)"},ROOT_URL:"/",CONTENT_URL:"/content.json"}</script><script src="/js/insight.js"></script></div></div></div><div id="main-nav-mobile" class="header-sub header-inner"><table class="menu outer"><tr><td><a class="main-nav-link" href="/cursos">Cursos Online</a></td><td><div class="search-form"><input type="text" class="ins-search-input search-form-input" placeholder="Buscar"></div></td></tr></table></div></header><div class="outer"><aside id="profile"><div class="inner profile-inner"><div class="base-info profile-block"><img id="avatar" src="https://www.gravatar.com/avatar/c6ea942080cef8be6ff80ca095e718b8?s=128"><h2 id="name">Alberto Basalo</h2><h3 id="title">Formador y Consultor</h3><span id="location"><i class="fa fa-map-marker"></i>A Coruña, Spain</span> <a id="follow" target="_blank" href="https://twitter.com/albertobasalo">SEGUIR</a></div><div class="article-info profile-block"><a href="https://angular.builders" style="align-content:center"><img src="/css/images/angular.builders_cuadrado.png" width="100%" height="auto" alt="Angular.Builders"></a></div><div class="profile-block social-links"><table><tr><td><a href="https://github.com/AcademiaBinaria" target="_blank" title="github" class="tooltip"><i class="fa fa-github"></i></a></td><td><a href="https://twitter.com/albertobasalo" target="_blank" title="twitter" class="tooltip"><i class="fa fa-twitter"></i></a></td><td><a href="https://www.facebook.com/Agora.Binaria.SL/" target="_blank" title="facebook" class="tooltip"><i class="fa fa-facebook"></i></a></td><td><a href="http://eepurl.com/b3p7fb" target="_blank" title="rss" class="tooltip"><i class="fa fa-rss"></i></a></td></tr></table></div></div></aside><section id="main"><article id="post-tests-unitarios-con-jest-y-e2e-con-cypress-en-Angular" class="article article-type-post" itemscope itemprop="blogPost"><div class="article-inner"><header class="article-header"><h1 class="article-title" itemprop="name">Tests unitarios con Jest y e2e con Cypress en Angular</h1><div class="article-meta"><div class="article-date"><i class="fa fa-calendar"></i> <a href="/tests-unitarios-con-jest-y-e2e-con-cypress-en-Angular/"><time datetime="2019-07-18T09:25:12.000Z" itemprop="datePublished">18-07-2019</time></a></div><div class="article-category"><i class="fa fa-folder"></i> <a class="article-category-link" href="/categories/Tutorial/">Tutorial</a><i class="fa fa-angle-right"></i><a class="article-category-link" href="/categories/Tutorial/Angular/">Angular</a></div><div class="article-tag"><i class="fa fa-tag"></i> <a class="tag-link" href="/tag/Angular/">Angular</a>, <a class="tag-link" href="/tag/Angular8/">Angular8</a>, <a class="tag-link" href="/tag/Avanzado/">Avanzado</a>, <a class="tag-link" href="/tag/Cypress/">Cypress</a>, <a class="tag-link" href="/tag/Jest/">Jest</a>, <a class="tag-link" href="/tag/Nx/">Nx</a>, <a class="tag-link" href="/tag/Test/">Test</a>, <a class="tag-link" href="/tag/Tutorial/">Tutorial</a></div></div></header><div class="article-entry" itemprop="articleBody"><p><img src="/images/tutorial-angular-11_test.png" alt="tests-unitarios-con-jest-y-e2e-con-cypress-en-Angular"></p><p>Continuamos este <strong>tutorial de Angular Avanzado</strong> con el tema controvertido del testing. Sí, ya sé que todos deberíamos hacerlo siempre, pero también sé que no es cierto. Así que vamos a ponerle remedio eliminando excusas y facilitando las pruebas automatizadas.</p><blockquote><p>Por si hace falta su defensa: Las pruebas automáticas de código son la principal técnica de reducción de bugs y garantizan el buen funcionamiento durante un refactoring. Bueno para el usuario bueno para el programador.</p></blockquote><p>Los desarrollos que hoy en día hacemos con <strong>Angular</strong> suelen ser de tamaño medio o grande y con una esperanza de vida y mantenimiento que se mide en años. Así que cuantas más pruebas tengamos menos miedo tendremos a cambiar el código. Y la necesidad de cambio siempre estará ahí. Veremos como <em>Jest</em> y <em>Cypress</em> nos ayudan muchísimo en la tarea.</p><p>De nuevo la gente de <em>Nrwl</em> ha pensado en ello y el <strong>Nx</strong> instala y configura dos productos de última generación que facilitan la tarea. Usaremos <a href="https://jestjs.io/" target="_blank" rel="noopener">Jest</a> para los test unitarios y <a href="https://www.cypress.io/" target="_blank" rel="noopener">Cypress</a> para los de integración <em>End to End</em>. Vamos a empezar por el final.</p><a id="more"></a><p>Partiendo del mono repositorio creado usando las herramientas de <a href="https://nrwl.io/" target="_blank" rel="noopener">Nrwl.io/</a> veremos que el <strong>Nx</strong> instala y configura dos productos de última generación que facilitan la tarea de las pruebas de software. Usaremos <a href="https://jestjs.io/" target="_blank" rel="noopener">Jest</a> para los test unitarios y <a href="https://www.cypress.io/" target="_blank" rel="noopener">Cypress</a> para los de integración <em>End to End</em>. Vamos a empezar por el final.</p><blockquote><p>Código asociado a este tutorial en <em>GitHub</em>: <a href="https://github.com/angularbuilders/angular-blueprint" target="_blank" rel="noopener">angular.builders/angular-blueprint/</a></p></blockquote><h2 id="Tabla-de-Contenido"><a href="#Tabla-de-Contenido" class="headerlink" title="Tabla de Contenido:"></a>Tabla de Contenido:</h2><p><a href="./#1-e2e-Dada-una-SPA-en-Angular">1. e2e: Dada una SPA en Angular.</a></p><p><a href="./#2-e2e-Dada-una-pagina-web-en-Angular">2. e2e: Dada una página web en Angular.</a></p><p><a href="./#3-e2e-Dada-una-libreria-en-Angular-con-componentes-de-diseno">3. e2e: Dada una librería en Angular con componentes de diseño.</a></p><p><a href="./#4-unit-Dada-una-libreria-TypeScript-con-servicios">4. unit: Dada una librería TypeScript con servicios.</a></p><p><a href="./#5-unit-Dada-una-libreria-Angular-con-servicios-de-instrumentacion">5. unit: Dada una librería Angular con servicios de instrumentación.</a></p><p><a href="./#Diagramas">Diagramas</a></p><p><a href="./#Resumen">Resumen</a></p><hr><h1 id="1-e2e-Dada-una-SPA-en-Angular"><a href="#1-e2e-Dada-una-SPA-en-Angular" class="headerlink" title="1. e2e: Dada una SPA en Angular."></a>1. e2e: Dada una SPA en Angular.</h1><blockquote><p>Dada una SPA en Angular cuando se visita la página de inicio entonces debería mostrar un enlace con el nombre de la aplicación y luego debería mostrar el logotipo</p></blockquote><p>Con cada aplicación generada se crea una hermana para sus pruebas <em>e2e</em>. Esa aplicación de pruebas está configurada y lista para compilar, servir y probar su aplicación objetivo. El comando <code>yarn e2e</code> lanzará el equivalente del cli <code>ng e2e</code>, el cual usará la configuración del <code>angular.json</code> para ejecutar <strong>Cypress</strong> con la configuración apropiada.</p><blockquote><p>Cypress es el equivalente a Protractor, el producto propio de Angular. La ventaja principal es que no está atado a ningún framework y por tanto lo que hagas valdrá para probar cualquier web en cualquier tecnología.</p></blockquote><p>Tu trabajo como <em>tester</em> será definir las pruebas en la carpeta <code>/integration</code>. Por ejemplo para empezar nos ofrecen el fichero <code>app-spec.ts</code> en el que yo he especificado el comportamiento deseado por mi página. La sintaxis se enciende por si misma. He seguido el convenio GIVEN, WHEN, THEN para especificar pruebas que podrían considerarse casi de comportamiento o aceptación.</p><p><code>integration/app.spec.ts</code></p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; getAppLink, getImage &#125; <span class="keyword">from</span> <span class="string">'../support/app.po'</span>;</span><br><span class="line"></span><br><span class="line">describe(<span class="string">'GIVEN an Angular SPA'</span>, <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  beforeEach(<span class="function"><span class="params">()</span> =&gt;</span> cy.visit(<span class="string">'/'</span>));</span><br><span class="line">  context(<span class="string">'WHEN user visits home page'</span>, <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    it(<span class="string">'THEN should display link with app name'</span>, <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      getAppLink().contains(<span class="string">'spa'</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">    it(<span class="string">'THEN should display the logo'</span>, <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      getImage()</span><br><span class="line">        .should(<span class="string">'have.attr'</span>, <span class="string">'src'</span>)</span><br><span class="line">        .should(<span class="string">'include'</span>, <span class="string">'logo.png'</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>La parte más técnica y tediosa es la que accede al DOM y lo mejor es tener eso a parte. En la carpeta <code>/support</code> nos sugieren que creemos utilidades para tratar con el <em>DOM</em> y de esa forma mantener los test lo más cercanos posible a un lenguaje natural de negocio. Como se ve en mi caso una aproximación libre al <a href="https://www.genbeta.com/desarrollo/bdd-cucumber-y-gherkin-desarrollo-dirigido-por-comportamiento" target="_blank" rel="noopener">BDD con gherkin</a> para mantener el espíritu de sencillez de un tutorial sobre tecnología Angular, no sobre testing.</p><p><code>support/app.po.ts</code></p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getAppLink = <span class="function"><span class="params">()</span> =&gt;</span> cy.get(<span class="string">'nav &gt; span &gt; a'</span>);</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getImage = <span class="function"><span class="params">()</span> =&gt;</span> cy.get(<span class="string">'img'</span>);</span><br></pre></td></tr></table></figure><hr><h1 id="2-e2e-Dada-una-pagina-web-en-Angular"><a href="#2-e2e-Dada-una-pagina-web-en-Angular" class="headerlink" title="2. e2e: Dada una página web en Angular."></a>2. e2e: Dada una página web en Angular.</h1><blockquote><p>Dada una página web en Angular cuando se visita la página de inicio entonces debería mostrar un mensaje de bienvenida y luego debería mostrar el logotipo</p></blockquote><p>Repito el proceso para la otra aplicación. Imagino que de esta forma verás las similitudes y sacarás conclusiones para optimizar tus pruebas. Puedes crear <em>scripts</em> específicos para lanzar las pruebas de cada aplicación por separado, o dejar que <strong>NX</strong> ejecute <strong>Cypress</strong> para todo el repositorio.</p><p><code>integration/app.spec.ts</code></p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; getGreeting, getImage &#125; <span class="keyword">from</span> <span class="string">'../support/app.po'</span>;</span><br><span class="line"></span><br><span class="line">describe(<span class="string">'GIVEN an Angular web'</span>, <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  beforeEach(<span class="function"><span class="params">()</span> =&gt;</span> cy.visit(<span class="string">'/'</span>));</span><br><span class="line">  context(<span class="string">'WHEN user visits home page'</span>, <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    it(<span class="string">'THEN should display welcome message'</span>, <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      getGreeting().contains(<span class="string">'Welcome to the Angular.Builders/blueprint for web!'</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">    it(<span class="string">'THEN should display the logo'</span>, <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      getImage()</span><br><span class="line">        .should(<span class="string">'have.attr'</span>, <span class="string">'src'</span>)</span><br><span class="line">        .should(<span class="string">'include'</span>, <span class="string">'logo.png'</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p><code>support/app.po.ts</code></p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getGreeting = <span class="function"><span class="params">()</span> =&gt;</span> cy.get(<span class="string">'h1'</span>);</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getImage = <span class="function"><span class="params">()</span> =&gt;</span> cy.get(<span class="string">'img'</span>);</span><br></pre></td></tr></table></figure><hr><h1 id="3-e2e-Dada-una-libreria-en-Angular-con-componentes-de-diseno"><a href="#3-e2e-Dada-una-libreria-en-Angular-con-componentes-de-diseno" class="headerlink" title="3. e2e: Dada una librería en Angular con componentes de diseño."></a>3. e2e: Dada una librería en Angular con componentes de diseño.</h1><blockquote><p>Dada una librería en Angular con componentes de diseño cuando visita una aplicación web que la consuma, entonces debería contener el componente header</p></blockquote><p>En este caso queremos probar una librería de componentes. Claro que se podrán hacer pruebas unitarias y de integración parcial. Pero también puedes incluirlas como parte de la prueba de integración total de la aplicación que la consume. De esta forma te aseguras de que el módulo de la librería se importa y que sus componentes se exportan correctamente. Por ejemplo lo uso desde la aplicación web simple para comprobar que se renderiza el componente de cabecera <code>ab-layout-header</code>.</p><p><code>integration/app.spec.ts</code></p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; getAbLayoutHeader &#125; <span class="keyword">from</span> <span class="string">'../support/app.po'</span>;</span><br><span class="line"></span><br><span class="line">describe(<span class="string">'GIVEN an Angular Library with layout components'</span>, <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  beforeEach(<span class="function"><span class="params">()</span> =&gt;</span> cy.visit(<span class="string">'/'</span>));</span><br><span class="line">  context(<span class="string">'WHEN user visits a consumer app'</span>, <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    it(<span class="string">'THEN should contains an ab-layout-header element'</span>, <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      getAbLayoutHeader().should(<span class="string">'exist'</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p><code>support/app.po.ts</code></p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getAbLayoutHeader = <span class="function"><span class="params">()</span> =&gt;</span></span><br><span class="line">  cy.get( <span class="string">'body &gt; ab-web-root &gt; ab-layout-header'</span> );</span><br></pre></td></tr></table></figure><hr><h1 id="4-unit-Dada-una-libreria-TypeScript-con-servicios"><a href="#4-unit-Dada-una-libreria-TypeScript-con-servicios" class="headerlink" title="4. unit: Dada una librería TypeScript con servicios."></a>4. unit: Dada una librería TypeScript con servicios.</h1><blockquote><p>Dada una biblioteca de TypeScript con servicios cuando necesito un ConsoleLogger entonces debería ser creado<br>Dado un registrador de trazas por consola cuando un dev quiere escribir un mensaje entonces debería ser capaz de dejar rastros amigables para el desarrollo.</p></blockquote><p>Le toca el turno ahora a los <strong>tests unitarios</strong>. Estos los haremos con el sencillo y potente framework de pruebas <strong>Jest</strong>. En este caso también viene configurado por <strong>Nx</strong> y listo para ejecutar mediante el script <code>yarn test</code>. La sintaxis es similar a cualquier otra herramienta del mundillo y creo que cualquiera puede hacerse una idea viendo el siguiente ejemplo.</p><p><code>services/console-tracer.driver.spec.ts</code></p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; ConsoleTracerDriver &#125; <span class="keyword">from</span> <span class="string">'./console-tracer.driver'</span>;</span><br><span class="line"></span><br><span class="line">describe(<span class="string">'GIVEN an TypeScript Library with services'</span>, <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  describe(<span class="string">'WHEN I need a ConsoleTracerDriver'</span>, <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    it(<span class="string">'THEN should be created'</span>, <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> tracer: ConsoleTracerDriver = <span class="keyword">new</span> ConsoleTracerDriver();</span><br><span class="line">      expect(tracer).toBeTruthy();</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">describe(<span class="string">'GIVEN a Console Tracer Driver'</span>, <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> tracer: ConsoleTracerDriver;</span><br><span class="line">  beforeEach(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    tracer = <span class="keyword">new</span> ConsoleTracerDriver();</span><br><span class="line">  &#125;);</span><br><span class="line">  describe(<span class="string">'WHEN a dev wants to write a message'</span>, <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    it(<span class="string">'THEN should be able to write dev friendly traces'</span>, <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> consoleMessage = tracer.writeTrace(&#123;</span><br><span class="line">        origin: <span class="string">'test'</span>,</span><br><span class="line">        level: <span class="string">'system'</span>,</span><br><span class="line">        message: <span class="string">'test works'</span></span><br><span class="line">      &#125;);</span><br><span class="line">      expect(consoleMessage).toBe(<span class="string">'[TEST]: test works'</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><hr><h1 id="5-unit-Dada-una-libreria-Angular-con-servicios-de-instrumentacion"><a href="#5-unit-Dada-una-libreria-Angular-con-servicios-de-instrumentacion" class="headerlink" title="5. unit: Dada una librería Angular con servicios de instrumentación."></a>5. unit: Dada una librería Angular con servicios de instrumentación.</h1><blockquote><p>Dada una biblioteca Angular con servicios de instrumentación cuando la biblioteca se compila entonces debe crearse el módulo AngularTracerModule<br>Dada una biblioteca Angular con servicios de instrumentación cuando necesito un servicio ConsoleTracer entonces debería ser creado</p></blockquote><p>Y por supuesto que podemos hacer pruebas unitarias sobre aplicaciones o librerías <strong>Angular</strong>. Al menos probaremos con un <em>smoke test</em> tanto la creación del módulo como la del servicio.</p><p><code>tracer.module.spec.ts</code></p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="keyword">async</span>, TestBed &#125; <span class="keyword">from</span> <span class="string">'@angular/core/testing'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; TracerModule &#125; <span class="keyword">from</span> <span class="string">'./tracer.module'</span>;</span><br><span class="line"></span><br><span class="line">describe(<span class="string">'GIVEN an Angular Library with instrumentation services '</span>, <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  describe(<span class="string">'WHEN the library compiles'</span>, <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    beforeEach(<span class="keyword">async</span>(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      TestBed.configureTestingModule(&#123;</span><br><span class="line">        imports: [TracerModule]</span><br><span class="line">      &#125;).compileComponents();</span><br><span class="line">    &#125;));</span><br><span class="line"></span><br><span class="line">    it(<span class="string">'THEN the AngularTracerModule should be created '</span>, <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      expect(TracerModule).toBeDefined();</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p><code>tracer.service.spec.ts</code></p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; TestBed &#125; <span class="keyword">from</span> <span class="string">'@angular/core/testing'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; TracerService, TRACER_CONFIG &#125; <span class="keyword">from</span> <span class="string">'./tracer.service'</span>;</span><br><span class="line"></span><br><span class="line">describe(<span class="string">'GIVEN an Angular Library with instrumentation services'</span>, <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  beforeEach(<span class="function"><span class="params">()</span> =&gt;</span> TestBed.configureTestingModule(&#123;&#125;));</span><br><span class="line"></span><br><span class="line">  describe(<span class="string">'WHEN I need a ConsoleTracer service'</span>, <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    it(<span class="string">'THEN should be created'</span>, <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> service: TracerService = TestBed.get(TracerService);</span><br><span class="line">      expect(service).toBeTruthy();</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><hr><h2 id="Diagramas"><a href="#Diagramas" class="headerlink" title="Diagramas"></a>Diagramas</h2><p>El siguiente diagrama nos muestra a vista de pájaro las aplicaciones de prueba <em>e2e</em> y las aplicaciones reales.</p><p><img src="/images/11-projects-dependency.png" alt="Dependencias entre proyectos"></p><hr><p>Para más información, o indicaciones paso a paso, consulta directamente la <a href="https://angularbuilders.github.io/angular-blueprint/1-test" target="_blank" rel="noopener">documentación</a> del proyecto en GitHub.</p><p>Las tareas relativas a este tutorial resueltas en el <a href="https://github.com/angularbuilders/angular-blueprint/projects/4" target="_blank" rel="noopener">proyecto 1 - test</a></p><p><img src="/css/images/angular.builders.png" alt="Angular.Builders"></p><p>La iniciativa <a href="https://angular.builders" target="_blank" rel="noopener">Angular.Builders</a> nace para ayudar a desarrolladores y arquitectos de software como tú. Ofrecemos formación y productos de ayuda y ejemplo como <a href="https://angularbuilders.github.io/angular-blueprint/" target="_blank" rel="noopener">angular.blueprint</a>.</p><p>Para más información sobre servicios de consultoría <a href="https://www.linkedin.com/in/albertobasalo/" target="_blank" rel="noopener">ponte en contacto conmigo</a>.</p><hr><h2 id="Resumen"><a href="#Resumen" class="headerlink" title="Resumen"></a>Resumen</h2><p>En definitiva, los grandes desarrollos demandados por bancos, multinacionales o administración pública requieren soluciones fiables y mantenibles. Y eso pasa inexcusablemente por hacer testing. <strong>Angular</strong> facilita las pruebas unitarias y de integración; especialmente con las herramientas <em>Jest</em> y <em>Cypress</em> ya configuradas por <strong>Nx</strong>.</p><p>Con este tutorial de formación <a href="../tag/Avanzado/">avanzada en Angular</a> te preparas para poder afrontar retos de tamaño industrial. Continúa aprendiendo a mejorar el rendimiento usando la <a href="../deteccion-del-cambio-en-Angular">detección del cambio en Angular</a>.</p><blockquote><p>Aprender, programar, disfrutar, repetir.<br>– <cite>Saludos, Alberto Basalo</cite></p></blockquote></div><footer class="article-footer"><div class="share-container"></div><a data-url="https://academia-binaria.com/tests-unitarios-con-jest-y-e2e-con-cypress-en-Angular/" data-id="cjysd9lwv000goos3du96ec3d" class="article-share-link"><i class="fa fa-share"></i>Compartir</a><script>!function(n){"undefined"!=typeof __SHARE_BUTTON_BINDED__&&__SHARE_BUTTON_BINDED__||(__SHARE_BUTTON_BINDED__=!0,n("body").on("click",function(){n(".article-share-box.on").removeClass("on")}).on("click",".article-share-link",function(t){t.stopPropagation();var e,a=n(this),o=a.attr("data-url"),i=encodeURIComponent(o),r="article-share-box-"+a.attr("data-id"),s=a.offset();if(n("#"+r).length){if((e=n("#"+r)).hasClass("on"))return void e.removeClass("on")}else{var l=['<div id="'+r+'" class="article-share-box">','<input class="article-share-input" value="'+o+'">','<div class="article-share-links">','<a href="https://twitter.com/intent/tweet?url='+i+'" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>','<a href="https://www.facebook.com/sharer.php?u='+i+'" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>','<a href="http://pinterest.com/pin/create/button/?url='+i+'" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>','<a href="https://plus.google.com/share?url='+i+'" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',"</div>","</div>"].join("");e=n(l),n("body").append(e)}n(".article-share-box.on").hide(),e.css({top:s.top+25,left:s.left}).addClass("on")}).on("click",".article-share-box",function(t){t.stopPropagation()}).on("click",".article-share-box-input",function(){n(this).select()}).on("click",".article-share-box-link",function(t){t.preventDefault(),t.stopPropagation(),window.open(this.href,"article-share-box-window-"+Date.now(),"width=500,height=450")}))}(jQuery)</script></footer></div><nav id="article-nav"><a href="/Material-Design-y-CLI-de-Angular/" id="article-nav-newer" class="article-nav-link-wrap"><strong class="article-nav-caption">Anterior</strong><div class="article-nav-title">Material Design y CLI de Angular</div></a><a href="/deteccion-del-cambio-en-Angular/" id="article-nav-older" class="article-nav-link-wrap"><strong class="article-nav-caption">Siguiente</strong><div class="article-nav-title">Detección del cambio en Angular</div></a></nav><a href="https://angular.builders"><img src="/css/images/angular.builders.png" alt="Angular.Builders"></a></article></section><aside id="sidebar"><div class="widget-wrap"><h3 class="widget-title">Recientes</h3><div class="widget"><ul id="recent-post"><li><div class="item-thumbnail"><a href="/nx-mono-repositorios-en-Angular/" class="thumbnail"><span style="background-image:url(/css/images/angular-10_monorepo.png)" alt="Nx, mono repositorios en Angular" class="thumbnail-image"></span></a></div><div class="item-inner"><p class="item-category"><a class="article-category-link" href="/categories/Tutorial/">Tutorial</a><i class="fa fa-angle-right"></i><a class="article-category-link" href="/categories/Tutorial/Angular/">Angular</a></p><p class="item-title"><a href="/nx-mono-repositorios-en-Angular/" class="title">Nx, mono repositorios en Angular</a></p><p class="item-date"><time datetime="2019-09-03T16:59:27.000Z" itemprop="datePublished">03-09-2019</time></p></div></li><li><div class="item-thumbnail"><a href="/flujo-reactivo-unidireccional-con-Angular-y-RxJs/" class="thumbnail"><span style="background-image:url(/css/images/angular-13_unidirectional.png)" alt="Flujo reactivo unidireccional con Angular y RxJs" class="thumbnail-image"></span></a></div><div class="item-inner"><p class="item-category"><a class="article-category-link" href="/categories/Tutorial/">Tutorial</a><i class="fa fa-angle-right"></i><a class="article-category-link" href="/categories/Tutorial/Angular/">Angular</a></p><p class="item-title"><a href="/flujo-reactivo-unidireccional-con-Angular-y-RxJs/" class="title">Flujo reactivo unidireccional con Angular y RxJs</a></p><p class="item-date"><time datetime="2019-08-05T09:46:34.000Z" itemprop="datePublished">05-08-2019</time></p></div></li><li><div class="item-thumbnail"><a href="/deteccion-del-cambio-en-Angular/" class="thumbnail"><span style="background-image:url(/css/images/angular-12_change.png)" alt="Detección del cambio en Angular" class="thumbnail-image"></span></a></div><div class="item-inner"><p class="item-category"><a class="article-category-link" href="/categories/Tutorial/">Tutorial</a><i class="fa fa-angle-right"></i><a class="article-category-link" href="/categories/Tutorial/Angular/">Angular</a></p><p class="item-title"><a href="/deteccion-del-cambio-en-Angular/" class="title">Detección del cambio en Angular</a></p><p class="item-date"><time datetime="2019-08-01T16:09:27.000Z" itemprop="datePublished">01-08-2019</time></p></div></li><li><div class="item-thumbnail"><a href="/tests-unitarios-con-jest-y-e2e-con-cypress-en-Angular/" class="thumbnail"><span style="background-image:url(/css/images/angular-11_test.png)" alt="Tests unitarios con Jest y e2e con Cypress en Angular" class="thumbnail-image"></span></a></div><div class="item-inner"><p class="item-category"><a class="article-category-link" href="/categories/Tutorial/">Tutorial</a><i class="fa fa-angle-right"></i><a class="article-category-link" href="/categories/Tutorial/Angular/">Angular</a></p><p class="item-title"><a href="/tests-unitarios-con-jest-y-e2e-con-cypress-en-Angular/" class="title">Tests unitarios con Jest y e2e con Cypress en Angular</a></p><p class="item-date"><time datetime="2019-07-18T09:25:12.000Z" itemprop="datePublished">18-07-2019</time></p></div></li><li><div class="item-thumbnail"><a href="/Material-Design-y-CLI-de-Angular/" class="thumbnail"><span style="background-image:url(/css/images/angular-9_material.png)" alt="Material Design y CLI de Angular" class="thumbnail-image"></span></a></div><div class="item-inner"><p class="item-category"><a class="article-category-link" href="/categories/Tutorial/">Tutorial</a><i class="fa fa-angle-right"></i><a class="article-category-link" href="/categories/Tutorial/Angular/">Angular</a></p><p class="item-title"><a href="/Material-Design-y-CLI-de-Angular/" class="title">Material Design y CLI de Angular</a></p><p class="item-date"><time datetime="2019-03-14T17:59:27.000Z" itemprop="datePublished">14-03-2019</time></p></div></li></ul></div></div><div class="widget-wrap"><h3 class="widget-title">Categorias</h3><div class="widget"><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Tutorial/">Tutorial</a><span class="category-list-count">17</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Tutorial/Angular/">Angular</a><span class="category-list-count">17</span></li></ul></li></ul></div></div><div class="widget-wrap"><h3 class="widget-title">Nube de etiquetas</h3><div class="widget tagcloud"><a href="/tag/Angular/" style="font-size:20px">Angular</a> <a href="/tag/Angular2/" style="font-size:18.75px">Angular2</a> <a href="/tag/Angular6/" style="font-size:11.25px">Angular6</a> <a href="/tag/Angular7/" style="font-size:15px">Angular7</a> <a href="/tag/Angular8/" style="font-size:17.5px">Angular8</a> <a href="/tag/AngularJS/" style="font-size:10px">AngularJS</a> <a href="/tag/Avanzado/" style="font-size:16.25px">Avanzado</a> <a href="/tag/BackEnd/" style="font-size:10px">BackEnd</a> <a href="/tag/CLI/" style="font-size:11.25px">CLI</a> <a href="/tag/ChangeDetection/" style="font-size:10px">ChangeDetection</a> <a href="/tag/Components/" style="font-size:10px">Components</a> <a href="/tag/Cypress/" style="font-size:10px">Cypress</a> <a href="/tag/DI/" style="font-size:10px">DI</a> <a href="/tag/Forms/" style="font-size:10px">Forms</a> <a href="/tag/FrontEnd/" style="font-size:10px">FrontEnd</a> <a href="/tag/Introduccion/" style="font-size:17.5px">Introducción</a> <a href="/tag/Jest/" style="font-size:10px">Jest</a> <a href="/tag/MongoDB/" style="font-size:10px">MongoDB</a> <a href="/tag/NgRx/" style="font-size:10px">NgRx</a> <a href="/tag/NodeJS/" style="font-size:13.75px">NodeJS</a> <a href="/tag/Nx/" style="font-size:11.25px">Nx</a> <a href="/tag/Observables/" style="font-size:11.25px">Observables</a> <a href="/tag/Opinion/" style="font-size:12.5px">Opinión</a> <a href="/tag/PWA/" style="font-size:10px">PWA</a> <a href="/tag/Redux/" style="font-size:10px">Redux</a> <a href="/tag/Routing/" style="font-size:10px">Routing</a> <a href="/tag/RxJS/" style="font-size:10px">RxJS</a> <a href="/tag/RxJs/" style="font-size:10px">RxJs</a> <a href="/tag/SPA/" style="font-size:10px">SPA</a> <a href="/tag/SSR/" style="font-size:10px">SSR</a> <a href="/tag/Servicios/" style="font-size:10px">Servicios</a> <a href="/tag/Test/" style="font-size:10px">Test</a> <a href="/tag/Tutorial/" style="font-size:20px">Tutorial</a> <a href="/tag/TypeScript/" style="font-size:10px">TypeScript</a> <a href="/tag/Universal/" style="font-size:10px">Universal</a> <a href="/tag/http/" style="font-size:11.25px">http</a> <a href="/tag/material/" style="font-size:10px">material</a> <a href="/tag/reactiveForms/" style="font-size:10px">reactiveForms</a></div></div><div class="widget-wrap widget-list"><h3 class="widget-title">Links</h3><div class="widget"><ul><li><a href="https://www.trainingit.es/curso-angular-basico/?promo=meetup10&af=abasalo">Intro</a></li><li><a href="https://www.trainingit.es/curso-angular-avanzado/?promo=meetup10&af=abasalo">Avanzado</a></li><li><a href="https://www.trainingit.es/curso-typescript/?promo=meetup10&af=abasalo">TypeScript</a></li><li><a href="http://referral.pluralsight.com/mQe488E">PluralSight</a></li></ul></div></div><div class="widget-wrap"><h3 class="widget-title">Archivos</h3><div class="widget"><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">septiembre 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">agosto 2019</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">julio 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">marzo 2019</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">febrero 2019</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">enero 2019</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">octubre 2018</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">marzo 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/05/">mayo 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">abril 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/03/">marzo 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/01/">enero 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/08/">agosto 2015</a><span class="archive-list-count">1</span></li></ul></div></div><div id="toTop" class="fa fa-angle-up"></div><div><a href="https://angular.builders" style="align-content:center"><img src="/css/images/angular.builders.png" width="100%" height="auto" alt="Angular.Builders"></a></div></aside></div><footer id="footer"><div class="outer"><div id="footer-info" class="inner">&copy; 2019 Developed by <a target="_blank" href="http://agorabinaria.com">Ágora Binaria</a>.</div></div></footer><script src="/js/main.js"></script><script src="//load.sumome.com/" data-sumo-site-id="24f3eb649e85fa1f7db20b7fa344f42f381f65f8f86f7028766c55d313e73eb5" async></script></div></body>